<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="220" skipped="0" tests="394" time="364.661" timestamp="2025-12-07T08:50:02.229926+00:00" hostname="haroon-HP-EliteBook-840-g6"><testcase classname="tests.integration.test_api" name="test_health_endpoint" time="245.309" /><testcase classname="tests.integration.test_api" name="test_graphql_endpoint_exists" time="0.038" /><testcase classname="tests.integration.test_api" name="test_graphql_shop_query" time="0.019" /><testcase classname="tests.integration.test_api" name="test_dashboard_endpoint" time="0.008" /><testcase classname="tests.unit.test_models" name="test_create_user" time="1.268" /><testcase classname="tests.unit.test_models" name="test_create_superuser" time="1.329" /><testcase classname="tests.unit.test_models" name="test_create_category" time="0.009" /><testcase classname="tests.unit.test_models" name="test_create_product_type" time="0.006" /><testcase classname="tests.unit.test_models" name="test_create_product" time="0.011" /><testcase classname="tests.unit.test_models" name="test_site_settings" time="0.009" /><testcase classname="tests.whitebox.test_account_utils.TestIsUserAddressLimitReached" name="test_address_limit_not_reached" time="0.688"><failure message="TypeError: Address() got unexpected keyword arguments: 'user'">tests/whitebox/test_account_utils.py:37: in test_address_limit_not_reached
    Address.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Address() got unexpected keyword arguments: 'user'</failure></testcase><testcase classname="tests.whitebox.test_account_utils.TestIsUserAddressLimitReached" name="test_address_limit_reached" time="0.798"><failure message="TypeError: Address() got unexpected keyword arguments: 'user'">tests/whitebox/test_account_utils.py:59: in test_address_limit_reached
    Address.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Address() got unexpected keyword arguments: 'user'</failure></testcase><testcase classname="tests.whitebox.test_account_utils.TestStoreUserAddress" name="test_store_address_limit_reached" time="0.825"><failure message="TypeError: Address() got unexpected keyword arguments: 'user'">tests/whitebox/test_account_utils.py:89: in test_store_address_limit_reached
    Address.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Address() got unexpected keyword arguments: 'user'</failure></testcase><testcase classname="tests.whitebox.test_account_utils.TestStoreUserAddress" name="test_store_address_existing_address" time="0.745"><failure message="TypeError: Address() got unexpected keyword arguments: 'user'">tests/whitebox/test_account_utils.py:119: in test_store_address_existing_address
    address = Address.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Address() got unexpected keyword arguments: 'user'</failure></testcase><testcase classname="tests.whitebox.test_account_utils.TestStoreUserAddress" name="test_store_address_new_address_billing" time="0.659" /><testcase classname="tests.whitebox.test_account_utils.TestStoreUserAddress" name="test_store_address_new_address_shipping" time="0.588" /><testcase classname="tests.whitebox.test_account_utils.TestStoreUserAddress" name="test_store_address_billing_with_existing_default" time="0.607"><failure message="TypeError: Address() got unexpected keyword arguments: 'user'">tests/whitebox/test_account_utils.py:186: in test_store_address_billing_with_existing_default
    existing = Address.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Address() got unexpected keyword arguments: 'user'</failure></testcase><testcase classname="tests.whitebox.test_account_utils.TestRemoveOldestAddressIfLimitReached" name="test_remove_if_limit_reached" time="0.613"><failure message="TypeError: Address() got unexpected keyword arguments: 'user'">tests/whitebox/test_account_utils.py:232: in test_remove_if_limit_reached
    addr = Address.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Address() got unexpected keyword arguments: 'user'</failure></testcase><testcase classname="tests.whitebox.test_account_utils.TestRemoveOldestAddressIfLimitReached" name="test_remove_if_limit_not_reached" time="0.621"><failure message="TypeError: Address() got unexpected keyword arguments: 'user'">tests/whitebox/test_account_utils.py:257: in test_remove_if_limit_not_reached
    Address.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Address() got unexpected keyword arguments: 'user'</failure></testcase><testcase classname="tests.whitebox.test_account_utils.TestRemoveOldestUserAddress" name="test_remove_oldest_not_default" time="0.579"><failure message="TypeError: Address() got unexpected keyword arguments: 'user'">tests/whitebox/test_account_utils.py:287: in test_remove_oldest_not_default
    oldest = Address.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Address() got unexpected keyword arguments: 'user'</failure></testcase><testcase classname="tests.whitebox.test_account_utils.TestRemoveOldestUserAddress" name="test_remove_oldest_is_default" time="0.612"><failure message="TypeError: Address() got unexpected keyword arguments: 'user'">tests/whitebox/test_account_utils.py:321: in test_remove_oldest_is_default
    oldest = Address.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Address() got unexpected keyword arguments: 'user'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations.TestBaseCheckoutSubtotal" name="test_base_checkout_subtotal_single_line" time="0.020"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'promotion_discount'">tests/whitebox/test_checkout_base_calculations.py:65: in test_base_checkout_subtotal_single_line
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'promotion_discount'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations.TestBaseCheckoutSubtotal" name="test_base_checkout_subtotal_empty_lines" time="0.005" /><testcase classname="tests.whitebox.test_checkout_base_calculations.TestBaseCheckoutSubtotal" name="test_base_checkout_subtotal_include_voucher_false" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'promotion_discount'">tests/whitebox/test_checkout_base_calculations.py:148: in test_base_checkout_subtotal_include_voucher_false
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'promotion_discount'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations.TestCheckoutTotal" name="test_checkout_total_no_discounts" time="0.013" /><testcase classname="tests.whitebox.test_checkout_base_calculations.TestCheckoutTotal" name="test_checkout_total_with_discount" time="0.010" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateBaseLineUnitPrice" name="test_calculate_base_line_unit_price_divides_total_by_quantity" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:76: in test_calculate_base_line_unit_price_divides_total_by_quantity
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateBaseLineTotalPrice" name="test_calculate_base_line_total_price_no_discounts_no_voucher" time="0.015"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:123: in test_calculate_base_line_total_price_no_discounts_no_voucher
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateBaseLineTotalPrice" name="test_calculate_base_line_total_price_with_discounts" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:168: in test_calculate_base_line_total_price_with_discounts
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateBaseLineTotalPrice" name="test_calculate_base_line_total_price_with_voucher_include_true" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:209: in test_calculate_base_line_total_price_with_voucher_include_true
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateBaseLineTotalPrice" name="test_calculate_base_line_total_price_with_voucher_include_false" time="0.013"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:253: in test_calculate_base_line_total_price_with_voucher_include_false
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateUndiscountedBaseLineTotalPrice" name="test_calculate_undiscounted_base_line_total_price" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:300: in test_calculate_undiscounted_base_line_total_price
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateUndiscountedBaseLineUnitPrice" name="test_calculate_undiscounted_base_line_unit_price" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:347: in test_calculate_undiscounted_base_line_unit_price
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestBaseCheckoutDeliveryPrice" name="test_base_checkout_delivery_price_no_shipping_voucher" time="0.008" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestBaseCheckoutDeliveryPrice" name="test_base_checkout_delivery_price_shipping_voucher_include_true" time="0.007" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestBaseCheckoutDeliveryPrice" name="test_base_checkout_delivery_price_shipping_voucher_include_false" time="0.008" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestBaseCheckoutDeliveryPrice" name="test_base_checkout_delivery_price_shipping_voucher_discount_exceeds_price" time="0.008" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestBaseCheckoutUndiscountedDeliveryPrice" name="test_base_checkout_undiscounted_delivery_price_not_shipping_method_info" time="0.008" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestBaseCheckoutUndiscountedDeliveryPrice" name="test_base_checkout_undiscounted_delivery_price_shipping_method_info" time="0.009" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateBasePriceForShippingMethod" name="test_calculate_base_price_no_shipping_method" time="0.010" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateBasePriceForShippingMethod" name="test_calculate_base_price_shipping_not_required" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;shipping_zone_id&quot; of relation &quot;shipping_shippingmethod&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2, Standard, null, 0, , null, {}, {}, null, null, null, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (2, Standard, null, 0, , null, {}, {}, null, null, null, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_checkout_base_calculations_comprehensive.py:550: in test_calculate_base_price_shipping_not_required
    shipping_method = ShippingMethod.objects.create(name="Standard")
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (2, Standard, null, 0, , null, {}, {}, null, null, null, null).</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateBasePriceForShippingMethod" name="test_calculate_base_price_shipping_required_with_method" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;shipping_zone_id&quot; of relation &quot;shipping_shippingmethod&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (3, Standard, null, 0, , null, {}, {}, null, null, null, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (3, Standard, null, 0, , null, {}, {}, null, null, null, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_checkout_base_calculations_comprehensive.py:575: in test_calculate_base_price_shipping_required_with_method
    shipping_method = ShippingMethod.objects.create(name="Standard")
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (3, Standard, null, 0, , null, {}, {}, null, null, null, null).</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCalculateBasePriceForShippingMethod" name="test_calculate_base_price_uses_lines_for_shipping_required" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;shipping_zone_id&quot; of relation &quot;shipping_shippingmethod&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (4, Standard, null, 0, , null, {}, {}, null, null, null, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (4, Standard, null, 0, , null, {}, {}, null, null, null, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_checkout_base_calculations_comprehensive.py:601: in test_calculate_base_price_uses_lines_for_shipping_required
    shipping_method = ShippingMethod.objects.create(name="Standard")
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (4, Standard, null, 0, , null, {}, {}, null, null, null, null).</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestBaseCheckoutTotal" name="test_base_checkout_total_sums_subtotal_and_shipping" time="0.008" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestBaseCheckoutSubtotal" name="test_base_checkout_subtotal_empty_lines" time="0.005" /><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestBaseCheckoutSubtotal" name="test_base_checkout_subtotal_multiple_lines" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:698: in test_base_checkout_subtotal_multiple_lines
    line_info1 = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestCheckoutTotal" name="test_checkout_total_calculates_with_gift_cards" time="0.008"><failure message="AttributeError: &lt;module 'saleor.checkout.base_calculations' from '/home/haroon/SQE/SQE_Project_Saleor/saleor/checkout/base_calculations.py'&gt; does not have the attribute 'calculate_checkout_total_with_gift_cards'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:753: in test_checkout_total_calculates_with_gift_cards
    with patch('saleor.checkout.base_calculations.calculate_checkout_total_with_gift_cards') as mock_calc:
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: &lt;module 'saleor.checkout.base_calculations' from '/home/haroon/SQE/SQE_Project_Saleor/saleor/checkout/base_calculations.py'&gt; does not have the attribute 'calculate_checkout_total_with_gift_cards'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestGetLineTotalPriceWithPropagatedCheckoutDiscount" name="test_get_line_total_price_finds_line" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:792: in test_get_line_total_price_finds_line
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestGetLineTotalPriceWithPropagatedCheckoutDiscount" name="test_get_line_total_price_line_not_found" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:846: in test_get_line_total_price_line_not_found
    line_info1 = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestPropagateCheckoutDiscountOnCheckoutLinesPrices" name="test_propagate_checkout_discount_single_line" time="0.013"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:911: in test_propagate_checkout_discount_single_line
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_base_calculations_comprehensive.TestPropagateCheckoutDiscountOnCheckoutLinesPrices" name="test_propagate_checkout_discount_multiple_lines" time="0.013"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_base_calculations_comprehensive.py:965: in test_propagate_checkout_discount_multiple_lines
    line_info1 = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_calculations_comprehensive.TestCalculateBaseLineUnitPrice" name="test_calculate_base_line_unit_price_basic" time="0.015"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_calculations_comprehensive.py:78: in test_calculate_base_line_unit_price_basic
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_calculations_comprehensive.TestCalculateBaseLineUnitPrice" name="test_calculate_base_line_unit_price_with_discounts" time="0.014"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_calculations_comprehensive.py:140: in test_calculate_base_line_unit_price_with_discounts
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_calculations_comprehensive.TestCalculateBaseLineTotalPrice" name="test_calculate_base_line_total_price_no_discounts" time="0.015"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_calculations_comprehensive.py:207: in test_calculate_base_line_total_price_no_discounts
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_calculations_comprehensive.TestCalculateBaseLineTotalPrice" name="test_calculate_base_line_total_price_with_discounts" time="0.015"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_calculations_comprehensive.py:268: in test_calculate_base_line_total_price_with_discounts
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_calculations_comprehensive.TestCalculateBaseLineTotalPrice" name="test_calculate_base_line_total_price_include_voucher_false" time="0.015"><failure message="AttributeError: property 'code' of 'Voucher' object has no setter">tests/whitebox/test_checkout_calculations_comprehensive.py:327: in test_calculate_base_line_total_price_include_voucher_false
    voucher = Voucher.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:558: in __init__
    _setattr(self, prop, value)
E   AttributeError: property 'code' of 'Voucher' object has no setter</failure></testcase><testcase classname="tests.whitebox.test_checkout_calculations_comprehensive.TestCalculateUndiscountedBaseLineTotalPrice" name="test_calculate_undiscounted_base_line_total_price" time="0.015"><failure message="TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'">tests/whitebox/test_checkout_calculations_comprehensive.py:399: in test_calculate_undiscounted_base_line_total_price
    line_info = CheckoutLineInfo(
E   TypeError: CheckoutLineInfo.__init__() got an unexpected keyword argument 'undiscounted_unit_price'</failure></testcase><testcase classname="tests.whitebox.test_checkout_calculations_comprehensive.TestBaseCheckoutDeliveryPrice" name="test_base_checkout_delivery_price_no_voucher" time="0.011"><failure message="AssertionError: assert Decimal('0.00') == Decimal('10.00')&#10; +  where Decimal('0.00') = Money('0.00', 'USD').amount&#10; +  and   Decimal('10.00') = Decimal('10.00')">tests/whitebox/test_checkout_calculations_comprehensive.py:464: in test_base_checkout_delivery_price_no_voucher
    assert delivery_price.amount == Decimal("10.00")
E   AssertionError: assert Decimal('0.00') == Decimal('10.00')
E    +  where Decimal('0.00') = Money('0.00', 'USD').amount
E    +  and   Decimal('10.00') = Decimal('10.00')</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestInvalidateCheckout" name="test_invalidate_checkout_with_recalculate_discount" time="0.009" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestInvalidateCheckout" name="test_invalidate_checkout_without_recalculate_discount" time="0.009" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestInvalidateCheckoutPrices" name="test_invalidate_checkout_prices_with_save" time="0.011" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestInvalidateCheckoutPrices" name="test_invalidate_checkout_prices_without_save" time="0.007" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestCheckVariantInStock" name="test_check_variant_in_stock_replace_mode" time="0.016" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestCheckVariantInStock" name="test_check_variant_in_stock_add_mode" time="0.019" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestCheckVariantInStock" name="test_check_variant_in_stock_no_existing_line" time="0.021" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestCheckVariantInStock" name="test_check_variant_in_stock_negative_quantity_error" time="0.016" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestCheckVariantInStock" name="test_check_variant_in_stock_with_check_quantity" time="0.016" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestAddVariantToCheckout" name="test_add_variant_to_checkout_product_not_published" time="0.015"><failure message="AttributeError: module 'saleor.checkout.utils' has no attribute 'ProductChannelListing'">tests/whitebox/test_checkout_utils_comprehensive.py:318: in test_add_variant_to_checkout_product_not_published
    with patch('saleor.checkout.utils.ProductChannelListing.objects.filter') as mock_filter:
/usr/lib/python3.12/unittest/mock.py:1442: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/usr/lib/python3.12/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'saleor.checkout.utils' has no attribute 'ProductChannelListing'</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestAddVariantToCheckout" name="test_add_variant_to_checkout_force_new_line" time="0.018"><failure message="AttributeError: module 'saleor.checkout.utils' has no attribute 'ProductChannelListing'">tests/whitebox/test_checkout_utils_comprehensive.py:355: in test_add_variant_to_checkout_force_new_line
    with patch('saleor.checkout.utils.ProductChannelListing.objects.filter') as mock_filter:
/usr/lib/python3.12/unittest/mock.py:1442: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/usr/lib/python3.12/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'saleor.checkout.utils' has no attribute 'ProductChannelListing'</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetVoucherDiscountForCheckout" name="test_get_voucher_discount_entire_order_apply_once" time="0.010"><failure message="NameError: name 'Money' is not defined">tests/whitebox/test_checkout_utils_comprehensive.py:406: in test_get_voucher_discount_entire_order_apply_once
    Money(Decimal("10.00"), "USD"),
    ^^^^^
E   NameError: name 'Money' is not defined</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetVoucherDiscountForCheckout" name="test_get_voucher_discount_entire_order_not_apply_once" time="0.009"><failure message="NameError: name 'Money' is not defined">tests/whitebox/test_checkout_utils_comprehensive.py:442: in test_get_voucher_discount_entire_order_not_apply_once
    mock_subtotal.return_value = Money(Decimal("20.00"), "USD")
                                 ^^^^^
E   NameError: name 'Money' is not defined</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetVoucherDiscountForCheckout" name="test_get_voucher_discount_shipping" time="0.010"><failure message="NameError: name 'Money' is not defined">tests/whitebox/test_checkout_utils_comprehensive.py:474: in test_get_voucher_discount_shipping
    mock_shipping.return_value = Money(Decimal("5.00"), "USD")
                                 ^^^^^
E   NameError: name 'Money' is not defined</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetVoucherDiscountForCheckout" name="test_get_voucher_discount_specific_product" time="0.013"><failure message="NameError: name 'Money' is not defined">tests/whitebox/test_checkout_utils_comprehensive.py:505: in test_get_voucher_discount_specific_product
    mock_products.return_value = Money(Decimal("3.00"), "USD")
                                 ^^^^^
E   NameError: name 'Money' is not defined</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetVoucherDiscountForCheckout" name="test_get_voucher_discount_unknown_type" time="0.015" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetVoucherForCheckout" name="test_get_voucher_for_checkout_no_voucher_code" time="0.013" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetVoucherForCheckout" name="test_get_voucher_for_checkout_voucher_code_not_found" time="0.015" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetVoucherForCheckout" name="test_get_voucher_for_checkout_voucher_code_found" time="0.026"><failure message="assert None == &lt;Voucher: Voucher object (5)&gt;">tests/whitebox/test_checkout_utils_comprehensive.py:600: in test_get_voucher_for_checkout_voucher_code_found
    assert voucher_result == voucher
E   assert None == &lt;Voucher: Voucher object (5)&gt;</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetVoucherForCheckout" name="test_get_voucher_for_checkout_usage_increased" time="0.013" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestRecalculateCheckoutDiscount" name="test_recalculate_checkout_discount_with_voucher" time="0.012"><failure message="NameError: name 'Money' is not defined">tests/whitebox/test_checkout_utils_comprehensive.py:659: in test_recalculate_checkout_discount_with_voucher
    mock_check.return_value = Money(Decimal("5.00"), "USD")
                              ^^^^^
E   NameError: name 'Money' is not defined</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestRecalculateCheckoutDiscount" name="test_recalculate_checkout_discount_no_voucher" time="0.010" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestIsShippingRequired" name="test_is_shipping_required_true" time="0.016"><failure message="NameError: name 'Money' is not defined">tests/whitebox/test_checkout_utils_comprehensive.py:736: in test_is_shipping_required_true
    undiscounted_unit_price=Money(Decimal("10.00"), "USD")
                            ^^^^^
E   NameError: name 'Money' is not defined</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestIsShippingRequired" name="test_is_shipping_required_false" time="0.016"><failure message="NameError: name 'Money' is not defined">tests/whitebox/test_checkout_utils_comprehensive.py:778: in test_is_shipping_required_false
    undiscounted_unit_price=Money(Decimal("10.00"), "USD")
                            ^^^^^
E   NameError: name 'Money' is not defined</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestCalculateCheckoutWeight" name="test_calculate_checkout_weight_sums_line_weights" time="0.015"><failure message="django.db.utils.IntegrityError: duplicate key value violates unique constraint &quot;product_producttype_slug_key&quot;&#10;DETAIL:  Key (slug)=() already exists.">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.UniqueViolation: duplicate key value violates unique constraint "product_producttype_slug_key"
E   DETAIL:  Key (slug)=() already exists.

The above exception was the direct cause of the following exception:
tests/whitebox/test_checkout_utils_comprehensive.py:809: in test_calculate_checkout_weight_sums_line_weights
    product_type=ProductType.objects.create(name="Type"),
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: duplicate key value violates unique constraint "product_producttype_slug_key"
E   DETAIL:  Key (slug)=() already exists.</failure></testcase><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetAddressForCheckoutTaxes" name="test_get_address_for_checkout_taxes_uses_shipping_address" time="0.008" /><testcase classname="tests.whitebox.test_checkout_utils_comprehensive.TestGetAddressForCheckoutTaxes" name="test_get_address_for_checkout_taxes_uses_billing_address" time="0.008" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_get_value_from_private_metadata_key_exists" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_get_value_from_private_metadata_key_not_exists" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_store_value_in_private_metadata_metadata_exists" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_store_value_in_private_metadata_metadata_none" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_clear_private_metadata" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_delete_value_from_private_metadata_key_exists" time="0.009" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_delete_value_from_private_metadata_key_not_exists" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_get_value_from_metadata_key_exists" time="0.011" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_get_value_from_metadata_key_not_exists" time="0.011" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_store_value_in_metadata_metadata_exists" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_store_value_in_metadata_metadata_none" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_clear_metadata" time="0.011" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_delete_value_from_metadata_key_exists" time="0.013" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataStatementCoverage" name="test_delete_value_from_metadata_key_not_exists" time="0.012" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataDecisionCoverage" name="test_decision_private_metadata_key_in_true" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataDecisionCoverage" name="test_decision_private_metadata_key_in_false" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataDecisionCoverage" name="test_decision_metadata_key_in_true" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestModelWithMetadataDecisionCoverage" name="test_decision_metadata_key_in_false" time="0.010" /><testcase classname="tests.whitebox.test_core_metadata.TestPublishableModelIsVisible" name="test_is_visible_published_true_published_at_none" time="0.008"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_metadata.py:362: in test_is_visible_published_true_published_at_none
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_metadata.TestPublishableModelIsVisible" name="test_is_visible_published_true_published_at_past" time="0.008"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_metadata.py:380: in test_is_visible_published_true_published_at_past
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_metadata.TestPublishableModelIsVisible" name="test_is_visible_published_true_published_at_future" time="0.008"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_metadata.py:398: in test_is_visible_published_true_published_at_future
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_metadata.TestPublishableModelIsVisible" name="test_is_visible_published_false" time="0.008"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_metadata.py:416: in test_is_visible_published_false
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelStatementCoverage" name="test_save_new_object_no_existing_max" time="0.007"><failure message="AttributeError: 'Category' object has no attribute 'sort_order'">tests/whitebox/test_core_models.py:34: in test_save_new_object_no_existing_max
    assert category.sort_order == 0
           ^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'Category' object has no attribute 'sort_order'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelStatementCoverage" name="test_save_new_object_with_existing_max" time="0.009"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:56: in test_save_new_object_with_existing_max
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelStatementCoverage" name="test_save_existing_object" time="0.008"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:81: in test_save_existing_object
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelStatementCoverage" name="test_delete_with_sort_order" time="0.010"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:124: in test_delete_with_sort_order
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelStatementCoverage" name="test_delete_without_sort_order" time="0.008"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:157: in test_delete_without_sort_order
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelDecisionCoverage" name="test_decision_coverage_save_pk_none_true" time="0.008"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:193: in test_decision_coverage_save_pk_none_true
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelDecisionCoverage" name="test_decision_coverage_save_pk_none_false" time="0.008"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:217: in test_decision_coverage_save_pk_none_false
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelDecisionCoverage" name="test_decision_coverage_delete_sort_order_not_none_true" time="0.010"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:251: in test_decision_coverage_delete_sort_order_not_none_true
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelDecisionCoverage" name="test_decision_coverage_delete_sort_order_not_none_false" time="0.008"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:275: in test_decision_coverage_delete_sort_order_not_none_false
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelMCDC" name="test_mcdc_get_max_sort_order_none" time="0.009"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:310: in test_mcdc_get_max_sort_order_none
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestSortableModelMCDC" name="test_mcdc_get_max_sort_order_exists" time="0.009"><failure message="NameError: name 'Collection' is not defined">tests/whitebox/test_core_models.py:340: in test_mcdc_get_max_sort_order_exists
    collection = Collection.objects.create(
                 ^^^^^^^^^^
E   NameError: name 'Collection' is not defined</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelStatementCoverage" name="test_published_with_published_at_in_past" time="0.007"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:362: in test_published_with_published_at_in_past
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelStatementCoverage" name="test_published_with_published_at_null" time="0.007"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:379: in test_published_with_published_at_null
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelStatementCoverage" name="test_published_with_published_at_future" time="0.007"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:396: in test_published_with_published_at_future
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelStatementCoverage" name="test_published_with_is_published_false" time="0.010"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:413: in test_published_with_is_published_false
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelDecisionCoverage" name="test_decision_published_at_lte_today_true" time="0.009"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:438: in test_decision_published_at_lte_today_true
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelDecisionCoverage" name="test_decision_published_at_lte_today_false" time="0.007"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:454: in test_decision_published_at_lte_today_false
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelDecisionCoverage" name="test_decision_published_at_isnull_true" time="0.008"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:470: in test_decision_published_at_isnull_true
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelDecisionCoverage" name="test_decision_is_published_true" time="0.008"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:486: in test_decision_is_published_true
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelDecisionCoverage" name="test_decision_is_published_false" time="0.008"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:502: in test_decision_is_published_false
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelMCDC" name="test_mcdc_condition_a_true_b_true" time="0.008"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:526: in test_mcdc_condition_a_true_b_true
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelMCDC" name="test_mcdc_condition_a_false_b_true" time="0.008"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:542: in test_mcdc_condition_a_false_b_true
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelMCDC" name="test_mcdc_condition_a_true_b_false" time="0.007"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:558: in test_mcdc_condition_a_true_b_false
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_models.TestPublishableModelMCDC" name="test_mcdc_condition_null_date" time="0.007"><failure message="TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'">tests/whitebox/test_core_models.py:574: in test_mcdc_condition_null_date
    product = Product.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Product() got unexpected keyword arguments: 'is_published', 'published_at'</failure></testcase><testcase classname="tests.whitebox.test_core_utils.TestGetClientIp" name="test_get_client_ip_x_forwarded_for_single" time="0.004" /><testcase classname="tests.whitebox.test_core_utils.TestGetClientIp" name="test_get_client_ip_x_forwarded_for_multiple" time="0.004" /><testcase classname="tests.whitebox.test_core_utils.TestGetClientIp" name="test_get_client_ip_remote_addr" time="0.004" /><testcase classname="tests.whitebox.test_core_utils.TestGetClientIp" name="test_get_client_ip_invalid_ip" time="0.004" /><testcase classname="tests.whitebox.test_core_utils.TestGetClientIp" name="test_get_client_ip_none" time="0.004"><failure message="AssertionError: assert None == '127.0.0.1'">tests/whitebox/test_core_utils.py:59: in test_get_client_ip_none
    assert ip == "127.0.0.1"
E   AssertionError: assert None == '127.0.0.1'</failure></testcase><testcase classname="tests.whitebox.test_core_utils.TestBuildAbsoluteUri" name="test_build_absolute_uri_with_domain" time="0.004" /><testcase classname="tests.whitebox.test_core_utils.TestBuildAbsoluteUri" name="test_build_absolute_uri_without_domain" time="0.006" /><testcase classname="tests.whitebox.test_core_utils.TestBuildAbsoluteUri" name="test_build_absolute_uri_https" time="0.004"><failure message="TypeError: build_absolute_uri() got an unexpected keyword argument 'protocol'">tests/whitebox/test_core_utils.py:85: in test_build_absolute_uri_https
    uri = build_absolute_uri("/path/to/resource", domain="example.com", protocol="https")
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: build_absolute_uri() got an unexpected keyword argument 'protocol'</failure></testcase><testcase classname="tests.whitebox.test_core_utils.TestBuildAbsoluteUri" name="test_build_absolute_uri_absolute_path" time="0.004" /><testcase classname="tests.whitebox.test_core_utils.TestBuildAbsoluteUri" name="test_build_absolute_uri_relative_path" time="0.004" /><testcase classname="tests.whitebox.test_core_utils.TestGetDomain" name="test_get_domain_with_site" time="0.006" /><testcase classname="tests.whitebox.test_core_utils.TestGetDomain" name="test_get_domain_without_site" time="0.006" /><testcase classname="tests.whitebox.test_core_utils.TestGetDomain" name="test_get_domain_none_site" time="0.005"><failure message="AttributeError: 'NoneType' object has no attribute 'domain'">tests/whitebox/test_core_utils.py:123: in test_get_domain_none_site
    domain = get_domain()
             ^^^^^^^^^^^^
saleor/core/utils/__init__.py:26: in get_domain
    return site.domain
           ^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'domain'</failure></testcase><testcase classname="tests.whitebox.test_core_utils.TestGetPublicUrl" name="test_get_public_url_with_domain" time="0.004" /><testcase classname="tests.whitebox.test_core_utils.TestGetPublicUrl" name="test_get_public_url_without_domain" time="0.006"><failure message="django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.">tests/whitebox/test_core_utils.py:145: in test_get_public_url_without_domain
    url = get_public_url()
          ^^^^^^^^^^^^^^^^
saleor/core/utils/__init__.py:32: in get_public_url
    host = domain or Site.objects.get_current().domain
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/site/patch_sites.py:29: in new_get_current
    self.prefetch_related("settings")
.venv/lib/python3.12/site-packages/django/db/models/query.py:437: in __getitem__
    qs._fetch_all()
.venv/lib/python3.12/site-packages/django/db/models/query.py:1954: in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:93: in __iter__
    results = compiler.execute_sql(
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1621: in execute_sql
    cursor = self.connection.cursor()
             ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/test/testcases.py:201: in __call__
    raise DatabaseOperationForbidden(self.message)
E   django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.</failure></testcase><testcase classname="tests.whitebox.test_core_utils.TestGetPublicUrl" name="test_get_public_url_https" time="0.004"><failure message="TypeError: get_public_url() got an unexpected keyword argument 'protocol'">tests/whitebox/test_core_utils.py:150: in test_get_public_url_https
    url = get_public_url(domain="example.com", protocol="https")
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: get_public_url() got an unexpected keyword argument 'protocol'</failure></testcase><testcase classname="tests.whitebox.test_core_utils.TestGetPublicUrl" name="test_get_public_url_none_domain" time="0.005"><failure message="django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.">tests/whitebox/test_core_utils.py:156: in test_get_public_url_none_domain
    url = get_public_url()
          ^^^^^^^^^^^^^^^^
saleor/core/utils/__init__.py:32: in get_public_url
    host = domain or Site.objects.get_current().domain
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/site/patch_sites.py:29: in new_get_current
    self.prefetch_related("settings")
.venv/lib/python3.12/site-packages/django/db/models/query.py:437: in __getitem__
    qs._fetch_all()
.venv/lib/python3.12/site-packages/django/db/models/query.py:1954: in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:93: in __iter__
    results = compiler.execute_sql(
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1621: in execute_sql
    cursor = self.connection.cursor()
             ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/test/testcases.py:201: in __call__
    raise DatabaseOperationForbidden(self.message)
E   django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestCalculateDiscountedPriceForRules" name="test_calculate_discounted_price_no_rules" time="0.004" /><testcase classname="tests.whitebox.test_discount_utils.TestCalculateDiscountedPriceForRules" name="test_calculate_discounted_price_with_rules" time="0.009"><failure message="NotImplementedError: Unknown discount type">tests/whitebox/test_discount_utils.py:72: in test_calculate_discounted_price_with_rules
    result = calculate_discounted_price_for_rules(
saleor/discount/utils/promotion.py:86: in calculate_discounted_price_for_rules
    discount = rule.get_discount(currency)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/discount/models.py:426: in get_discount
    raise NotImplementedError("Unknown discount type")
E   NotImplementedError: Unknown discount type</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestCalculateDiscountedPriceForRules" name="test_calculate_discounted_price_multiple_rules" time="0.009"><failure message="NotImplementedError: Unknown discount type">tests/whitebox/test_discount_utils.py:111: in test_calculate_discounted_price_multiple_rules
    result = calculate_discounted_price_for_rules(
saleor/discount/utils/promotion.py:86: in calculate_discounted_price_for_rules
    discount = rule.get_discount(currency)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/discount/models.py:426: in get_discount
    raise NotImplementedError("Unknown discount type")
E   NotImplementedError: Unknown discount type</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestCalculateDiscountedPriceForRules" name="test_calculate_discounted_price_result_negative" time="0.007"><failure message="NotImplementedError: Unknown discount type">tests/whitebox/test_discount_utils.py:143: in test_calculate_discounted_price_result_negative
    result = calculate_discounted_price_for_rules(
saleor/discount/utils/promotion.py:86: in calculate_discounted_price_for_rules
    discount = rule.get_discount(currency)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/discount/models.py:426: in get_discount
    raise NotImplementedError("Unknown discount type")
E   NotImplementedError: Unknown discount type</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestPreparePromotionDiscountReason" name="test_prepare_reason_with_old_sale_id" time="0.006"><failure message="AssertionError: assert '123' in 'Sale: U2FsZToxMjM='&#10; +  where '123' = str(123)&#10; +    where 123 = &lt;Promotion: Promotion object (271467b1-3e74-4ab1-b198-d24bfc57af22)&gt;.old_sale_id">tests/whitebox/test_discount_utils.py:172: in test_prepare_reason_with_old_sale_id
    assert str(promotion.old_sale_id) in reason
E   AssertionError: assert '123' in 'Sale: U2FsZToxMjM='
E    +  where '123' = str(123)
E    +    where 123 = &lt;Promotion: Promotion object (271467b1-3e74-4ab1-b198-d24bfc57af22)&gt;.old_sale_id</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestPreparePromotionDiscountReason" name="test_prepare_reason_without_old_sale_id" time="0.005"><failure message="AssertionError: assert '01da898f-a60c-4755-85e0-6c2bb7e26094' in 'Promotion: UHJvbW90aW9uOjAxZGE4OThmLWE2MGMtNDc1NS04NWUwLTZjMmJiN2UyNjA5NA=='&#10; +  where '01da898f-a60c-4755-85e0-6c2bb7e26094' = str(UUID('01da898f-a60c-4755-85e0-6c2bb7e26094'))&#10; +    where UUID('01da898f-a60c-4755-85e0-6c2bb7e26094') = &lt;Promotion: Promotion object (01da898f-a60c-4755-85e0-6c2bb7e26094)&gt;.id">tests/whitebox/test_discount_utils.py:185: in test_prepare_reason_without_old_sale_id
    assert str(promotion.id) in reason
E   AssertionError: assert '01da898f-a60c-4755-85e0-6c2bb7e26094' in 'Promotion: UHJvbW90aW9uOjAxZGE4OThmLWE2MGMtNDc1NS04NWUwLTZjMmJiN2UyNjA5NA=='
E    +  where '01da898f-a60c-4755-85e0-6c2bb7e26094' = str(UUID('01da898f-a60c-4755-85e0-6c2bb7e26094'))
E    +    where UUID('01da898f-a60c-4755-85e0-6c2bb7e26094') = &lt;Promotion: Promotion object (01da898f-a60c-4755-85e0-6c2bb7e26094)&gt;.id</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestGetSaleId" name="test_get_sale_id_with_old_sale_id" time="0.006"><failure message="AssertionError: assert 'Sale' in 'U2FsZTo0NTY='">tests/whitebox/test_discount_utils.py:205: in test_get_sale_id_with_old_sale_id
    assert "Sale" in sale_id
E   AssertionError: assert 'Sale' in 'U2FsZTo0NTY='</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestGetSaleId" name="test_get_sale_id_without_old_sale_id" time="0.005"><failure message="AssertionError: assert 'Promotion' in 'UHJvbW90aW9uOjc2OGQwNmY2LWQxZTYtNDdmZS04ZTkzLTU1MjhhOTczNzJkNQ=='">tests/whitebox/test_discount_utils.py:218: in test_get_sale_id_without_old_sale_id
    assert "Promotion" in sale_id
E   AssertionError: assert 'Promotion' in 'UHJvbW90aW9uOjc2OGQwNmY2LWQxZTYtNDdmZS04ZTkzLTU1MjhhOTczNzJkNQ=='</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestIsOrderLevelVoucher" name="test_is_order_level_voucher_entire_order" time="0.005"><failure message="AttributeError: property 'code' of 'Voucher' object has no setter">tests/whitebox/test_discount_utils.py:231: in test_is_order_level_voucher_entire_order
    voucher = Voucher.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:558: in __init__
    _setattr(self, prop, value)
E   AttributeError: property 'code' of 'Voucher' object has no setter</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestIsOrderLevelVoucher" name="test_is_order_level_voucher_shipping" time="0.005"><failure message="AttributeError: property 'code' of 'Voucher' object has no setter">tests/whitebox/test_discount_utils.py:241: in test_is_order_level_voucher_shipping
    voucher = Voucher.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:558: in __init__
    _setattr(self, prop, value)
E   AttributeError: property 'code' of 'Voucher' object has no setter</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestIsOrderLevelVoucher" name="test_is_order_level_voucher_specific_product" time="0.005"><failure message="AttributeError: property 'code' of 'Voucher' object has no setter">tests/whitebox/test_discount_utils.py:251: in test_is_order_level_voucher_specific_product
    voucher = Voucher.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:558: in __init__
    _setattr(self, prop, value)
E   AttributeError: property 'code' of 'Voucher' object has no setter</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestIsOrderLevelVoucher" name="test_is_order_level_voucher_none" time="0.007" /><testcase classname="tests.whitebox.test_discount_utils.TestIsShippingVoucher" name="test_is_shipping_voucher_true" time="0.006"><failure message="AttributeError: property 'code' of 'Voucher' object has no setter">tests/whitebox/test_discount_utils.py:274: in test_is_shipping_voucher_true
    voucher = Voucher.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:558: in __init__
    _setattr(self, prop, value)
E   AttributeError: property 'code' of 'Voucher' object has no setter</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestIsShippingVoucher" name="test_is_shipping_voucher_false" time="0.006"><failure message="AttributeError: property 'code' of 'Voucher' object has no setter">tests/whitebox/test_discount_utils.py:284: in test_is_shipping_voucher_false
    voucher = Voucher.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:558: in __init__
    _setattr(self, prop, value)
E   AttributeError: property 'code' of 'Voucher' object has no setter</failure></testcase><testcase classname="tests.whitebox.test_discount_utils.TestIsShippingVoucher" name="test_is_shipping_voucher_none" time="0.007" /><testcase classname="tests.whitebox.test_order_base_calculations.TestBaseOrderShipping" name="test_base_order_shipping" time="0.012"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:29.181835+00, , , 8b51100f-675c-4148-9617-96830865fd51, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 69, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:29.183205+00, f, 1, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:29.181835+00, , , 8b51100f-675c-4148-9617-96830865fd51, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 69, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:29.183205+00, f, 1, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations.py:42: in test_base_order_shipping
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:29.181835+00, , , 8b51100f-675c-4148-9617-96830865fd51, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 69, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:29.183205+00, f, 1, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations.TestBaseOrderSubtotal" name="test_base_order_subtotal_single_line" time="0.011"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:29.803022+00, , , 256e36bb-3b6a-4fdf-8803-0ab0bcdb8dac, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 70, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:29.803983+00, f, 2, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:29.803022+00, , , 256e36bb-3b6a-4fdf-8803-0ab0bcdb8dac, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 70, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:29.803983+00, f, 2, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations.py:68: in test_base_order_subtotal_single_line
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:29.803022+00, , , 256e36bb-3b6a-4fdf-8803-0ab0bcdb8dac, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 70, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:29.803983+00, f, 2, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations.TestBaseOrderSubtotal" name="test_base_order_subtotal_multiple_lines" time="0.012"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:30.465348+00, , , 734fe5ce-40c5-4bb7-8a84-4c73c83b2e34, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 71, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:30.466585+00, f, 3, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:30.465348+00, , , 734fe5ce-40c5-4bb7-8a84-4c73c83b2e34, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 71, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:30.466585+00, f, 3, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations.py:111: in test_base_order_subtotal_multiple_lines
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:30.465348+00, , , 734fe5ce-40c5-4bb7-8a84-4c73c83b2e34, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 71, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:30.466585+00, f, 3, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations.TestBaseOrderSubtotal" name="test_base_order_subtotal_empty_lines" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:31.044361+00, , , 487582fa-7caa-48a0-af97-77ae813319e1, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 72, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:31.045144+00, f, 4, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:31.044361+00, , , 487582fa-7caa-48a0-af97-77ae813319e1, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 72, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:31.045144+00, f, 4, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations.py:163: in test_base_order_subtotal_empty_lines
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:31.044361+00, , , 487582fa-7caa-48a0-af97-77ae813319e1, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 72, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:31.045144+00, f, 4, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations.TestBaseOrderLineTotal" name="test_base_order_line_total" time="0.010"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:31.616967+00, , , 1f30b61a-c6b7-4330-9ffe-b24be46413f3, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 73, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:31.617992+00, f, 5, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:31.616967+00, , , 1f30b61a-c6b7-4330-9ffe-b24be46413f3, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 73, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:31.617992+00, f, 5, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations.py:188: in test_base_order_line_total
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:31.616967+00, , , 1f30b61a-c6b7-4330-9ffe-b24be46413f3, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 73, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:31.617992+00, f, 5, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations.TestBaseOrderTotal" name="test_base_order_total" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:32.415225+00, , , 7a80ef2a-5f8a-4075-8ced-8ec15e8dd147, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 74, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:32.416082+00, f, 6, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:32.415225+00, , , 7a80ef2a-5f8a-4075-8ced-8ec15e8dd147, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 74, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:32.416082+00, f, 6, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations.py:243: in test_base_order_total
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:32.415225+00, , , 7a80ef2a-5f8a-4075-8ced-8ec15e8dd147, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 74, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:32.416082+00, f, 6, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_discount_no_discounts" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:32.993664+00, , , b3ed2c08-1df7-434e-9f81-3da6de5092ac, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 75, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:32.994533+00, f, 7, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:32.993664+00, , , b3ed2c08-1df7-434e-9f81-3da6de5092ac, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 75, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:32.994533+00, f, 7, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations.py:299: in test_propagate_discount_no_discounts
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:32.993664+00, , , b3ed2c08-1df7-434e-9f81-3da6de5092ac, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 75, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:32.994533+00, f, 7, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_discount_with_entire_order_voucher" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:33.527656+00, , , 43efe46b-9199-4aa6-9377-7025444f2af8, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 76, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:33.52849+00, f, 8, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:33.527656+00, , , 43efe46b-9199-4aa6-9377-7025444f2af8, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 76, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:33.52849+00, f, 8, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations.py:341: in test_propagate_discount_with_entire_order_voucher
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:33.527656+00, , , 43efe46b-9199-4aa6-9377-7025444f2af8, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 76, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:33.52849+00, f, 8, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestBaseOrderShipping" name="test_base_order_shipping_returns_base_shipping_price" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:34.076146+00, , , 7d2c1701-cc4e-47ce-ab99-1f50e31af526, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 77, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:34.076946+00, f, 9, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:34.076146+00, , , 7d2c1701-cc4e-47ce-ab99-1f50e31af526, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 77, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:34.076946+00, f, 9, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:63: in test_base_order_shipping_returns_base_shipping_price
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:34.076146+00, , , 7d2c1701-cc4e-47ce-ab99-1f50e31af526, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 77, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:34.076946+00, f, 9, null, 0.000, none, none, null, t, f, 10.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestBaseOrderSubtotal" name="test_base_order_subtotal_empty_lines" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:34.56684+00, , , 83b95c33-33eb-42b7-8ce7-b199a17e8690, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 78, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:34.567602+00, f, 10, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:34.56684+00, , , 83b95c33-33eb-42b7-8ce7-b199a17e8690, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 78, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:34.567602+00, f, 10, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:85: in test_base_order_subtotal_empty_lines
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:34.56684+00, , , 83b95c33-33eb-42b7-8ce7-b199a17e8690, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 78, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:34.567602+00, f, 10, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestBaseOrderSubtotal" name="test_base_order_subtotal_single_line" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:35.040014+00, , , 1452c46b-b0b6-446e-9965-3abda8e5ae3a, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 79, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:35.0408+00, f, 11, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:35.040014+00, , , 1452c46b-b0b6-446e-9965-3abda8e5ae3a, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 79, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:35.0408+00, f, 11, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:100: in test_base_order_subtotal_single_line
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:35.040014+00, , , 1452c46b-b0b6-446e-9965-3abda8e5ae3a, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 79, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:35.0408+00, f, 11, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestBaseOrderSubtotal" name="test_base_order_subtotal_multiple_lines" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:35.503175+00, , , 7c544ab2-cfb9-422f-be5a-96e14b7d6d0d, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 80, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:35.50385+00, f, 12, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:35.503175+00, , , 7c544ab2-cfb9-422f-be5a-96e14b7d6d0d, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 80, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:35.50385+00, f, 12, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:120: in test_base_order_subtotal_multiple_lines
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:35.503175+00, , , 7c544ab2-cfb9-422f-be5a-96e14b7d6d0d, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 80, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:35.50385+00, f, 12, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestBaseOrderTotal" name="test_base_order_total_calls_calculate_prices" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:35.95336+00, , , c46a309d-fe9e-4928-aea0-97c50d2944a9, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 81, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:35.954035+00, f, 13, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:35.95336+00, , , c46a309d-fe9e-4928-aea0-97c50d2944a9, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 81, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:35.954035+00, f, 13, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:151: in test_base_order_total_calls_calculate_prices
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:35.95336+00, , , c46a309d-fe9e-4928-aea0-97c50d2944a9, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 81, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:35.954035+00, f, 13, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestBaseOrderLineTotal" name="test_base_order_line_total_calculates_correctly" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:36.405714+00, , , 4723974d-bd96-46b8-b9ed-8cfee6b8ce24, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 82, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:36.406358+00, f, 14, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:36.405714+00, , , 4723974d-bd96-46b8-b9ed-8cfee6b8ce24, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 82, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:36.406358+00, f, 14, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:182: in test_base_order_line_total_calculates_correctly
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:36.405714+00, , , 4723974d-bd96-46b8-b9ed-8cfee6b8ce24, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 82, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:36.406358+00, f, 14, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_order_discount_no_discounts" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:36.858844+00, , , cf950dff-a7a6-410d-a67a-79fa88669549, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 83, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:36.859512+00, f, 15, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:36.858844+00, , , cf950dff-a7a6-410d-a67a-79fa88669549, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 83, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:36.859512+00, f, 15, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:209: in test_propagate_order_discount_no_discounts
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:36.858844+00, , , cf950dff-a7a6-410d-a67a-79fa88669549, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 83, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:36.859512+00, f, 15, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_order_discount_voucher_order_level" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:37.297088+00, , , 33593be5-f302-4362-b54a-72a91d0d1393, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 84, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:37.297725+00, f, 16, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:37.297088+00, , , 33593be5-f302-4362-b54a-72a91d0d1393, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 84, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:37.297725+00, f, 16, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:231: in test_propagate_order_discount_voucher_order_level
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:37.297088+00, , , 33593be5-f302-4362-b54a-72a91d0d1393, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 84, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:37.297725+00, f, 16, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_order_discount_voucher_shipping" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:37.71902+00, , , 3cd9a406-c98c-4a1b-b8e6-01432e9affc7, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 85, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:37.719892+00, f, 17, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:37.71902+00, , , 3cd9a406-c98c-4a1b-b8e6-01432e9affc7, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 85, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:37.719892+00, f, 17, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:268: in test_propagate_order_discount_voucher_shipping
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:37.71902+00, , , 3cd9a406-c98c-4a1b-b8e6-01432e9affc7, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 85, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:37.719892+00, f, 17, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_order_discount_order_promotion" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:38.206285+00, , , 2146a7c5-8d25-42ff-a21e-5f0e2c6143c7, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 86, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:38.206968+00, f, 18, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:38.206285+00, , , 2146a7c5-8d25-42ff-a21e-5f0e2c6143c7, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 86, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:38.206968+00, f, 18, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:303: in test_propagate_order_discount_order_promotion
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:38.206285+00, , , 2146a7c5-8d25-42ff-a21e-5f0e2c6143c7, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 86, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:38.206968+00, f, 18, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_order_discount_manual_percentage" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:38.663533+00, , , 163d9df1-2172-4719-b49e-c30e80730c2b, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 87, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:38.664304+00, f, 19, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:38.663533+00, , , 163d9df1-2172-4719-b49e-c30e80730c2b, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 87, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:38.664304+00, f, 19, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:335: in test_propagate_order_discount_manual_percentage
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:38.663533+00, , , 163d9df1-2172-4719-b49e-c30e80730c2b, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 87, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:38.664304+00, f, 19, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_order_discount_manual_fixed_positive_total" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:39.120183+00, , , d4e128e0-8213-4607-af86-a0fa4aaf3d48, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 88, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:39.121252+00, f, 20, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:39.120183+00, , , d4e128e0-8213-4607-af86-a0fa4aaf3d48, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 88, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:39.121252+00, f, 20, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:370: in test_propagate_order_discount_manual_fixed_positive_total
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:39.120183+00, , , d4e128e0-8213-4607-af86-a0fa4aaf3d48, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 88, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:39.121252+00, f, 20, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_order_discount_manual_fixed_zero_total" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:39.580875+00, , , 057f781f-0844-4777-8eb6-1aad77bdec78, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 89, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:39.581587+00, f, 21, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:39.580875+00, , , 057f781f-0844-4777-8eb6-1aad77bdec78, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 89, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:39.581587+00, f, 21, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:403: in test_propagate_order_discount_manual_fixed_zero_total
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:39.580875+00, , , 057f781f-0844-4777-8eb6-1aad77bdec78, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 89, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:39.581587+00, f, 21, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderPrices" name="test_propagate_order_discount_updates_amount" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:40.037291+00, , , e2f0fafd-8c90-4513-adc1-d512beecacf4, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 90, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:40.037946+00, f, 22, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:40.037291+00, , , e2f0fafd-8c90-4513-adc1-d512beecacf4, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 90, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:40.037946+00, f, 22, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:435: in test_propagate_order_discount_updates_amount
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:40.037291+00, , , e2f0fafd-8c90-4513-adc1-d512beecacf4, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 90, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:40.037946+00, f, 22, null, 0.000, none, none, null, t, f, 5.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestCalculatePrices" name="test_calculate_prices_with_assign_prices_true" time="0.010"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:40.833395+00, , , b90b183f-a88d-4d19-af13-faf4d343f350, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 91, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:40.834312+00, f, 23, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:40.833395+00, , , b90b183f-a88d-4d19-af13-faf4d343f350, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 91, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:40.834312+00, f, 23, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:478: in test_calculate_prices_with_assign_prices_true
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:40.833395+00, , , b90b183f-a88d-4d19-af13-faf4d343f350, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 91, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:40.834312+00, f, 23, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestCalculatePrices" name="test_calculate_prices_with_assign_prices_false" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:41.341878+00, , , 2033a122-5aa9-415b-95bc-0833b8b0025c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 92, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:41.342583+00, f, 24, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:41.341878+00, , , 2033a122-5aa9-415b-95bc-0833b8b0025c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 92, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:41.342583+00, f, 24, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:507: in test_calculate_prices_with_assign_prices_false
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:41.341878+00, , , 2033a122-5aa9-415b-95bc-0833b8b0025c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 92, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:41.342583+00, f, 24, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestGetTotalPriceWithSubtotalDiscountForOrderLine" name="test_get_total_price_positive_discount" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:41.815644+00, , , b3cc7801-1e13-49cd-9b42-0bf2a87c3171, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 93, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:41.816352+00, f, 25, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:41.815644+00, , , b3cc7801-1e13-49cd-9b42-0bf2a87c3171, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 93, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:41.816352+00, f, 25, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:537: in test_get_total_price_positive_discount
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:41.815644+00, , , b3cc7801-1e13-49cd-9b42-0bf2a87c3171, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 93, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:41.816352+00, f, 25, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestGetTotalPriceWithSubtotalDiscountForOrderLine" name="test_get_total_price_discount_exceeds_total" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:42.288129+00, , , c4bc0d78-37a5-41ed-a6f2-fe0d8451422c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 94, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:42.288833+00, f, 26, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:42.288129+00, , , c4bc0d78-37a5-41ed-a6f2-fe0d8451422c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 94, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:42.288833+00, f, 26, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:558: in test_get_total_price_discount_exceeds_total
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:42.288129+00, , , c4bc0d78-37a5-41ed-a6f2-fe0d8451422c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 94, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:42.288833+00, f, 26, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderLinesPrices" name="test_propagate_discount_single_line" time="0.011"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:42.784111+00, , , 1ec105b7-d2ee-4dbc-b890-ae862950ae18, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 95, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:42.785417+00, f, 27, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:42.784111+00, , , 1ec105b7-d2ee-4dbc-b890-ae862950ae18, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 95, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:42.785417+00, f, 27, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:584: in test_propagate_discount_single_line
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:42.784111+00, , , 1ec105b7-d2ee-4dbc-b890-ae862950ae18, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 95, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:42.785417+00, f, 27, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderLinesPrices" name="test_propagate_discount_multiple_lines" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:43.279411+00, , , ee161fed-f899-43cf-a887-581934e42030, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 96, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:43.280088+00, f, 28, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:43.279411+00, , , ee161fed-f899-43cf-a887-581934e42030, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 96, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:43.280088+00, f, 28, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:612: in test_propagate_discount_multiple_lines
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:43.279411+00, , , ee161fed-f899-43cf-a887-581934e42030, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 96, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:43.280088+00, f, 28, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestPropagateOrderDiscountOnOrderLinesPrices" name="test_propagate_discount_zero_base_subtotal" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:43.750019+00, , , 97bed36b-6902-4076-8939-b80714a432b6, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 97, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:43.751126+00, f, 29, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:43.750019+00, , , 97bed36b-6902-4076-8939-b80714a432b6, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 97, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:43.751126+00, f, 29, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:647: in test_propagate_discount_zero_base_subtotal
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:43.750019+00, , , 97bed36b-6902-4076-8939-b80714a432b6, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 97, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:43.751126+00, f, 29, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestGetTotalPriceWithSubtotalDiscountForOrderLineFunction" name="test_get_total_price_finds_line" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:44.226546+00, , , 7d4926a7-82d0-4aec-b53f-d6b2e85e69cb, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 98, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:44.22738+00, f, 30, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:44.226546+00, , , 7d4926a7-82d0-4aec-b53f-d6b2e85e69cb, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 98, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:44.22738+00, f, 30, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:679: in test_get_total_price_finds_line
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:44.226546+00, , , 7d4926a7-82d0-4aec-b53f-d6b2e85e69cb, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 98, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:44.22738+00, f, 30, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestGetTotalPriceWithSubtotalDiscountForOrderLineFunction" name="test_get_total_price_line_not_found" time="0.010"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:44.70243+00, , , 4106a9f7-436f-4931-b8e8-b89904808d8e, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 99, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:44.703352+00, f, 31, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:44.70243+00, , , 4106a9f7-436f-4931-b8e8-b89904808d8e, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 99, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:44.703352+00, f, 31, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:705: in test_get_total_price_line_not_found
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:44.70243+00, , , 4106a9f7-436f-4931-b8e8-b89904808d8e, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 99, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:44.703352+00, f, 31, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestApplySubtotalDiscountToOrderLines" name="test_apply_subtotal_discount_calls_assign" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:45.18879+00, , , 4e7cb3b0-f4ec-4780-aa24-ade50b8cc083, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 100, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:45.189462+00, f, 32, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:45.18879+00, , , 4e7cb3b0-f4ec-4780-aa24-ade50b8cc083, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 100, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:45.189462+00, f, 32, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:743: in test_apply_subtotal_discount_calls_assign
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:45.18879+00, , , 4e7cb3b0-f4ec-4780-aa24-ade50b8cc083, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 100, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:45.189462+00, f, 32, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestAssignOrderLinePrices" name="test_assign_order_line_prices_positive_quantity" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:45.678402+00, , , bf5be1c0-fad3-4ac0-b309-38a45ecc8b82, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 101, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:45.679172+00, f, 33, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:45.678402+00, , , bf5be1c0-fad3-4ac0-b309-38a45ecc8b82, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 101, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:45.679172+00, f, 33, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:772: in test_assign_order_line_prices_positive_quantity
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:45.678402+00, , , bf5be1c0-fad3-4ac0-b309-38a45ecc8b82, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 101, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:45.679172+00, f, 33, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestAssignOrderLinePrices" name="test_assign_order_line_prices_zero_quantity" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:46.259861+00, , , 03bf2d29-d618-4151-963c-b3e1c9918e8d, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 102, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:46.260624+00, f, 34, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:46.259861+00, , , 03bf2d29-d618-4151-963c-b3e1c9918e8d, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 102, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:46.260624+00, f, 34, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:798: in test_assign_order_line_prices_zero_quantity
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:46.259861+00, , , 03bf2d29-d618-4151-963c-b3e1c9918e8d, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 102, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:46.260624+00, f, 34, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestAssignOrderPrices" name="test_assign_order_prices_sets_all_fields" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:46.7519+00, , , 361c11d5-a1d7-4bb4-8d96-8ef6cc2b5f25, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 103, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:46.752617+00, f, 35, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:46.7519+00, , , 361c11d5-a1d7-4bb4-8d96-8ef6cc2b5f25, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 103, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:46.752617+00, f, 35, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:828: in test_assign_order_prices_sets_all_fields
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:46.7519+00, , , 361c11d5-a1d7-4bb4-8d96-8ef6cc2b5f25, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 103, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:46.752617+00, f, 35, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestUndiscountedOrderShipping" name="test_undiscounted_order_shipping_with_shipping_method" time="0.006"><failure message="django.db.utils.IntegrityError: null value in column &quot;shipping_zone_id&quot; of relation &quot;shipping_shippingmethod&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (6, Standard, null, 0, , null, {}, {}, null, null, null, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (6, Standard, null, 0, , null, {}, {}, null, null, null, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:861: in test_undiscounted_order_shipping_with_shipping_method
    shipping_method = ShippingMethod.objects.create(name="Standard")
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (6, Standard, null, 0, , null, {}, {}, null, null, null, null).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestUndiscountedOrderShipping" name="test_undiscounted_order_shipping_no_shipping_method" time="0.011"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:47.852536+00, , , b3654947-5589-40fc-875c-4f3f4bce3403, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 105, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:47.853486+00, f, 36, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:47.852536+00, , , b3654947-5589-40fc-875c-4f3f4bce3403, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 105, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:47.853486+00, f, 36, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:883: in test_undiscounted_order_shipping_no_shipping_method
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:47.852536+00, , , b3654947-5589-40fc-875c-4f3f4bce3403, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 105, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:47.853486+00, f, 36, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestUndiscountedOrderShipping" name="test_undiscounted_order_shipping_no_listing" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;shipping_zone_id&quot; of relation &quot;shipping_shippingmethod&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (7, Standard, null, 0, , null, {}, {}, null, null, null, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (7, Standard, null, 0, , null, {}, {}, null, null, null, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:899: in test_undiscounted_order_shipping_no_listing
    shipping_method = ShippingMethod.objects.create(name="Standard")
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "shipping_zone_id" of relation "shipping_shippingmethod" violates not-null constraint
E   DETAIL:  Failing row contains (7, Standard, null, 0, , null, {}, {}, null, null, null, null).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestUndiscountedOrderSubtotal" name="test_undiscounted_order_subtotal_calculates_correctly" time="0.010"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:49.189618+00, , , 9d31bc6b-49a6-4509-8119-c2ce751ff655, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 107, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:49.190626+00, f, 37, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:49.189618+00, , , 9d31bc6b-49a6-4509-8119-c2ce751ff655, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 107, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:49.190626+00, f, 37, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:921: in test_undiscounted_order_subtotal_calculates_correctly
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:49.189618+00, , , 9d31bc6b-49a6-4509-8119-c2ce751ff655, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 107, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:49.190626+00, f, 37, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_base_calculations_comprehensive.TestUndiscountedOrderTotal" name="test_undiscounted_order_total_sums_subtotal_and_shipping" time="0.013"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:49.721527+00, , , 6ed9b045-9144-4af4-8cf0-b0c706fe9506, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 108, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:49.72272+00, f, 38, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:49.721527+00, , , 6ed9b045-9144-4af4-8cf0-b0c706fe9506, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 108, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:49.72272+00, f, 38, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_base_calculations_comprehensive.py:947: in test_undiscounted_order_total_sums_subtotal_and_shipping
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:49.721527+00, , , 6ed9b045-9144-4af4-8cf0-b0c706fe9506, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 108, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:49.72272+00, f, 38, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredStatementCoverage" name="test_order_status_not_editable" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:50.209792+00, , , 5a5ca6f8-ed9f-44a6-a559-633fb009c86a, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, fulfilled, null, null, t, , 0, , USD, {}, {}, 109, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:50.210498+00, f, 39, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:50.209792+00, , , 5a5ca6f8-ed9f-44a6-a559-633fb009c86a, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, fulfilled, null, null, t, , 0, , USD, {}, {}, 109, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:50.210498+00, f, 39, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:36: in test_order_status_not_editable
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:50.209792+00, , , 5a5ca6f8-ed9f-44a6-a559-633fb009c86a, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, fulfilled, null, null, t, , 0, , USD, {}, {}, 109, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:50.210498+00, f, 39, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredStatementCoverage" name="test_no_force_update_no_refresh_no_expired" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:50.663646+00, , , a5f90b5b-da59-4992-8074-be1853bece79, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 110, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:50.664418+00, f, 40, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:50.663646+00, , , a5f90b5b-da59-4992-8074-be1853bece79, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 110, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:50.664418+00, f, 40, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:58: in test_no_force_update_no_refresh_no_expired
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:50.663646+00, , , a5f90b5b-da59-4992-8074-be1853bece79, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 110, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:50.664418+00, f, 40, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredStatementCoverage" name="test_tax_strategy_tax_app_no_sync_webhooks" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:51.114464+00, , , 21e3909b-29d0-40b8-9231-63383f634c09, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 111, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:51.115305+00, f, 41, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:51.114464+00, , , 21e3909b-29d0-40b8-9231-63383f634c09, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 111, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:51.115305+00, f, 41, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:81: in test_tax_strategy_tax_app_no_sync_webhooks
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:51.114464+00, , , 21e3909b-29d0-40b8-9231-63383f634c09, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 111, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:51.115305+00, f, 41, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredStatementCoverage" name="test_expired_line_ids_exists" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:51.555824+00, , , d11cb78b-88a2-4d91-a89a-6ad5e14229b3, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 112, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:51.556518+00, f, 42, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:51.555824+00, , , d11cb78b-88a2-4d91-a89a-6ad5e14229b3, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 112, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:51.556518+00, f, 42, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:106: in test_expired_line_ids_exists
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:51.555824+00, , , d11cb78b-88a2-4d91-a89a-6ad5e14229b3, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 112, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:51.556518+00, f, 42, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredStatementCoverage" name="test_no_expired_line_ids" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:52.02233+00, , , 3e8cf166-44ed-4afa-ac67-697156ccaefc, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 113, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:52.023543+00, f, 43, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:52.02233+00, , , 3e8cf166-44ed-4afa-ac67-697156ccaefc, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 113, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:52.023543+00, f, 43, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:138: in test_no_expired_line_ids
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:52.02233+00, , , 3e8cf166-44ed-4afa-ac67-697156ccaefc, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 113, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:52.023543+00, f, 43, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredDecisionCoverage" name="test_decision_order_status_editable_true" time="0.011"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:52.564332+00, , , fca7a9f7-9795-4d54-9327-8a996d2c9742, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 114, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:52.565203+00, f, 44, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:52.564332+00, , , fca7a9f7-9795-4d54-9327-8a996d2c9742, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 114, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:52.565203+00, f, 44, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:177: in test_decision_order_status_editable_true
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:52.564332+00, , , fca7a9f7-9795-4d54-9327-8a996d2c9742, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 114, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:52.565203+00, f, 44, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredDecisionCoverage" name="test_decision_order_status_editable_false" time="0.010"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:53.149572+00, , , 67b716c1-038b-46e0-b67b-288cb0071818, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, canceled, null, null, t, , 0, , USD, {}, {}, 115, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:53.150524+00, f, 45, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:53.149572+00, , , 67b716c1-038b-46e0-b67b-288cb0071818, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, canceled, null, null, t, , 0, , USD, {}, {}, 115, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:53.150524+00, f, 45, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:205: in test_decision_order_status_editable_false
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:53.149572+00, , , 67b716c1-038b-46e0-b67b-288cb0071818, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, canceled, null, null, t, , 0, , USD, {}, {}, 115, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:53.150524+00, f, 45, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredDecisionCoverage" name="test_decision_force_update_true" time="0.010"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:53.706527+00, , , 9d120906-345c-42d0-9983-39bd0b4f7c59, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 116, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:53.707422+00, f, 46, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:53.706527+00, , , 9d120906-345c-42d0-9983-39bd0b4f7c59, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 116, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:53.707422+00, f, 46, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:228: in test_decision_force_update_true
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:53.706527+00, , , 9d120906-345c-42d0-9983-39bd0b4f7c59, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 116, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:53.707422+00, f, 46, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredDecisionCoverage" name="test_decision_force_update_false_should_refresh_true" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:54.238493+00, , , 160506b8-0dc8-45b4-a5b0-1de6dd1c3b65, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 117, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:54.239247+00, f, 47, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:54.238493+00, , , 160506b8-0dc8-45b4-a5b0-1de6dd1c3b65, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 117, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:54.239247+00, f, 47, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:257: in test_decision_force_update_false_should_refresh_true
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:54.238493+00, , , 160506b8-0dc8-45b4-a5b0-1de6dd1c3b65, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 117, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:54.239247+00, f, 47, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredDecisionCoverage" name="test_decision_expired_line_ids_exists_true" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:54.715418+00, , , f9350d15-8137-4f15-87c5-1540e9a92079, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 118, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:54.716127+00, f, 48, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:54.715418+00, , , f9350d15-8137-4f15-87c5-1540e9a92079, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 118, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:54.716127+00, f, 48, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:286: in test_decision_expired_line_ids_exists_true
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:54.715418+00, , , f9350d15-8137-4f15-87c5-1540e9a92079, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 118, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:54.716127+00, f, 48, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredDecisionCoverage" name="test_decision_expired_line_ids_exists_false" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:55.193302+00, , , 2e80fd96-6ca2-4ff7-b18b-6a893585506e, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 119, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:55.194047+00, f, 49, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:55.193302+00, , , 2e80fd96-6ca2-4ff7-b18b-6a893585506e, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 119, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:55.194047+00, f, 49, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:317: in test_decision_expired_line_ids_exists_false
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:55.193302+00, , , 2e80fd96-6ca2-4ff7-b18b-6a893585506e, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 119, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:55.194047+00, f, 49, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredMCDC" name="test_mcdc_condition_force_update_true" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:55.63587+00, , , f42f3b77-19c4-4f6b-a9c6-48110cd59ab9, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 120, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:55.63656+00, f, 50, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:55.63587+00, , , f42f3b77-19c4-4f6b-a9c6-48110cd59ab9, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 120, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:55.63656+00, f, 50, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:355: in test_mcdc_condition_force_update_true
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:55.63587+00, , , f42f3b77-19c4-4f6b-a9c6-48110cd59ab9, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 120, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:55.63656+00, f, 50, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredMCDC" name="test_mcdc_condition_should_refresh_true" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:56.199295+00, , , 46cd0f0c-3c5d-4ebf-919e-0d5d6427cfb1, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 121, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:56.200063+00, f, 51, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:56.199295+00, , , 46cd0f0c-3c5d-4ebf-919e-0d5d6427cfb1, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 121, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:56.200063+00, f, 51, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:384: in test_mcdc_condition_should_refresh_true
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:56.199295+00, , , 46cd0f0c-3c5d-4ebf-919e-0d5d6427cfb1, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 121, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:56.200063+00, f, 51, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredMCDC" name="test_mcdc_condition_expired_line_ids_true" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:56.686786+00, , , 3de92328-845f-4abe-a10a-979ca4b07b2b, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 122, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:56.687551+00, f, 52, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:56.686786+00, , , 3de92328-845f-4abe-a10a-979ca4b07b2b, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 122, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:56.687551+00, f, 52, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:413: in test_mcdc_condition_expired_line_ids_true
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:56.686786+00, , , 3de92328-845f-4abe-a10a-979ca4b07b2b, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 122, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:56.687551+00, f, 52, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_calculations.TestFetchOrderPricesIfExpiredMCDC" name="test_mcdc_condition_all_false" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:57.126971+00, , , fe80f121-d7af-49da-836f-24f9bf24bbfb, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 123, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:57.127666+00, f, 53, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:57.126971+00, , , fe80f121-d7af-49da-836f-24f9bf24bbfb, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 123, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:57.127666+00, f, 53, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_calculations.py:444: in test_mcdc_condition_all_false
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:57.126971+00, , , fe80f121-d7af-49da-836f-24f9bf24bbfb, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 123, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:57.127666+00, f, 53, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestGetOrderCountry" name="test_get_order_country_uses_shipping_address" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:57.820675+00, , , 9fd76a3a-5832-40c7-97c3-b2d412f1c873, null, 4, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 124, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:57.821374+00, f, 54, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:57.820675+00, , , 9fd76a3a-5832-40c7-97c3-b2d412f1c873, null, 4, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 124, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:57.821374+00, f, 54, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:72: in test_get_order_country_uses_shipping_address
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:57.820675+00, , , 9fd76a3a-5832-40c7-97c3-b2d412f1c873, null, 4, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 124, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:57.821374+00, f, 54, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestOrderLineNeedsAutomaticFulfillment" name="test_order_line_needs_automatic_fulfillment_no_digital_content" time="0.005"><failure message="django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.">tests/whitebox/test_order_utils_comprehensive.py:96: in test_order_line_needs_automatic_fulfillment_no_digital_content
    result = order_line_needs_automatic_fulfillment(line_data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/order/utils.py:101: in order_line_needs_automatic_fulfillment
    digital_content_settings = get_default_digital_content_settings()
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/product/utils/digital_products.py:12: in get_default_digital_content_settings
    site = Site.objects.get_current()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/site/patch_sites.py:29: in new_get_current
    self.prefetch_related("settings")
.venv/lib/python3.12/site-packages/django/db/models/query.py:437: in __getitem__
    qs._fetch_all()
.venv/lib/python3.12/site-packages/django/db/models/query.py:1954: in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:93: in __iter__
    results = compiler.execute_sql(
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1621: in execute_sql
    cursor = self.connection.cursor()
             ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/test/testcases.py:201: in __call__
    raise DatabaseOperationForbidden(self.message)
E   django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestOrderLineNeedsAutomaticFulfillment" name="test_order_line_needs_automatic_fulfillment_default_settings_true" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestOrderLineNeedsAutomaticFulfillment" name="test_order_line_needs_automatic_fulfillment_default_settings_false" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestOrderLineNeedsAutomaticFulfillment" name="test_order_line_needs_automatic_fulfillment_content_automatic_true" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestOrderNeedsAutomaticFulfillment" name="test_order_needs_automatic_fulfillment_no_digital_lines" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestOrderNeedsAutomaticFulfillment" name="test_order_needs_automatic_fulfillment_digital_line_needs_fulfillment" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestInvalidateOrderPrices" name="test_invalidate_order_prices_editable_status" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:58.564579+00, , , 5d3a59c8-d2ef-4976-8c94-b91840c43171, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 125, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:58.565301+00, f, 55, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:58.564579+00, , , 5d3a59c8-d2ef-4976-8c94-b91840c43171, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 125, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:58.565301+00, f, 55, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:179: in test_invalidate_order_prices_editable_status
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:58.564579+00, , , 5d3a59c8-d2ef-4976-8c94-b91840c43171, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 125, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:58.565301+00, f, 55, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestInvalidateOrderPrices" name="test_invalidate_order_prices_non_editable_status" time="0.010"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:59.034101+00, , , f1ea5050-824f-47d5-a091-92bf30e42fec, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, fulfilled, null, null, t, , 0, , USD, {}, {}, 126, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:59.035271+00, f, 56, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:59.034101+00, , , f1ea5050-824f-47d5-a091-92bf30e42fec, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, fulfilled, null, null, t, , 0, , USD, {}, {}, 126, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:59.035271+00, f, 56, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:195: in test_invalidate_order_prices_non_editable_status
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:59.034101+00, , , f1ea5050-824f-47d5-a091-92bf30e42fec, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, fulfilled, null, null, t, , 0, , USD, {}, {}, 126, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:59.035271+00, f, 56, null, 0.000, none, none, null, f, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestInvalidateOrderPrices" name="test_invalidate_order_prices_with_save" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:59.486425+00, , , c4c8ab1a-d4be-4b06-a45d-780c386d78e1, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 127, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:59.487282+00, f, 57, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:59.486425+00, , , c4c8ab1a-d4be-4b06-a45d-780c386d78e1, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 127, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:59.487282+00, f, 57, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:213: in test_invalidate_order_prices_with_save
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:59.486425+00, , , c4c8ab1a-d4be-4b06-a45d-780c386d78e1, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, draft, null, null, t, , 0, , USD, {}, {}, 127, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:59.487282+00, f, 57, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestRecalculateOrderWeight" name="test_recalculate_order_weight_sums_line_weights" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:54:59.960016+00, , , a01b8780-6896-44b9-a793-80a6904a0aec, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 128, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:59.960741+00, f, 58, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:59.960016+00, , , a01b8780-6896-44b9-a793-80a6904a0aec, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 128, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:59.960741+00, f, 58, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:235: in test_recalculate_order_weight_sums_line_weights
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:54:59.960016+00, , , a01b8780-6896-44b9-a793-80a6904a0aec, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 128, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:54:59.960741+00, f, 58, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestDetermineOrderStatus" name="test_determine_order_status_unfulfilled" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestDetermineOrderStatus" name="test_determine_order_status_unfulfilled_with_awaiting" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestDetermineOrderStatus" name="test_determine_order_status_partially_returned" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestDetermineOrderStatus" name="test_determine_order_status_returned" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestDetermineOrderStatus" name="test_determine_order_status_partially_fulfilled" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestDetermineOrderStatus" name="test_determine_order_status_fulfilled" time="0.004" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestRefreshOrderStatus" name="test_refresh_order_status_all_products_replaced" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:00.45799+00, , , e5445a27-fbd4-4705-bb65-efd235b0a469, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 129, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:00.458653+00, f, 59, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:00.45799+00, , , e5445a27-fbd4-4705-bb65-efd235b0a469, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 129, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:00.458653+00, f, 59, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:347: in test_refresh_order_status_all_products_replaced
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:00.45799+00, , , e5445a27-fbd4-4705-bb65-efd235b0a469, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 129, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:00.458653+00, f, 59, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestRefreshOrderStatus" name="test_refresh_order_status_status_changes" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:00.924704+00, , , 20f31d41-486d-482a-a79d-7ebe7a521c69, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 130, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:00.92538+00, f, 60, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:00.924704+00, , , 20f31d41-486d-482a-a79d-7ebe7a521c69, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 130, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:00.92538+00, f, 60, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:378: in test_refresh_order_status_status_changes
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:00.924704+00, , , 20f31d41-486d-482a-a79d-7ebe7a521c69, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 130, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:00.92538+00, f, 60, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderStatus" name="test_update_order_status_with_transaction" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:01.376879+00, , , c401407e-9554-4b56-a0b1-75b03d68fdac, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 131, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:01.377559+00, f, 61, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:01.376879+00, , , c401407e-9554-4b56-a0b1-75b03d68fdac, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 131, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:01.377559+00, f, 61, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:407: in test_update_order_status_with_transaction
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:01.376879+00, , , c401407e-9554-4b56-a0b1-75b03d68fdac, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 131, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:01.377559+00, f, 61, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestGetTotalOrderDiscount" name="test_get_total_order_discount_sums_all_discounts" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:01.831857+00, , , e7d2d66b-5fce-4751-b6d6-705efcb6ce76, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 132, null, null, 100.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:01.832557+00, f, 62, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:01.831857+00, , , e7d2d66b-5fce-4751-b6d6-705efcb6ce76, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 132, null, null, 100.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:01.832557+00, f, 62, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:433: in test_get_total_order_discount_sums_all_discounts
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:01.831857+00, , , e7d2d66b-5fce-4751-b6d6-705efcb6ce76, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 132, null, null, 100.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:01.832557+00, f, 62, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestGetTotalOrderDiscount" name="test_get_total_order_discount_caps_at_undiscounted_total" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:02.293441+00, , , fd3e40dc-4c6b-4409-aa5c-36363fe3dd67, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 133, null, null, 10.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:02.294111+00, f, 63, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:02.293441+00, , , fd3e40dc-4c6b-4409-aa5c-36363fe3dd67, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 133, null, null, 10.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:02.294111+00, f, 63, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:466: in test_get_total_order_discount_caps_at_undiscounted_total
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:02.293441+00, , , fd3e40dc-4c6b-4409-aa5c-36363fe3dd67, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 133, null, null, 10.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:02.294111+00, f, 63, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestGetTotalOrderDiscountExcludingShipping" name="test_get_total_order_discount_excluding_shipping_no_shipping_voucher" time="0.010"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:02.753507+00, , , 6c400893-3d39-4a29-9654-c3dd368b921c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 134, null, null, 100.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:02.754585+00, f, 64, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:02.753507+00, , , 6c400893-3d39-4a29-9654-c3dd368b921c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 134, null, null, 100.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:02.754585+00, f, 64, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:496: in test_get_total_order_discount_excluding_shipping_no_shipping_voucher
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:02.753507+00, , , 6c400893-3d39-4a29-9654-c3dd368b921c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 134, null, null, 100.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:02.754585+00, f, 64, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestGetTotalOrderDiscountExcludingShipping" name="test_get_total_order_discount_excluding_shipping_with_shipping_voucher" time="0.006"><failure message="ValueError: Cannot assign &quot;&lt;Mock id='126857131388000'&gt;&quot;: &quot;Order.voucher&quot; must be a &quot;Voucher&quot; instance.">tests/whitebox/test_order_utils_comprehensive.py:524: in test_get_total_order_discount_excluding_shipping_with_shipping_voucher
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:545: in __init__
    _setattr(self, field.name, rel_obj)
.venv/lib/python3.12/site-packages/django/db/models/fields/related_descriptors.py:291: in __set__
    raise ValueError(
E   ValueError: Cannot assign "&lt;Mock id='126857131388000'&gt;": "Order.voucher" must be a "Voucher" instance.</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderChargeStatus" name="test_update_order_charge_status_full" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:03.435944+00, , , 3a68f538-ab08-48b9-8f31-091ca21f04df, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 136, null, null, 0.000, 0.000, 100.000, , null, null, , 2025-12-07 08:55:03.436582+00, f, 66, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:03.435944+00, , , 3a68f538-ab08-48b9-8f31-091ca21f04df, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 136, null, null, 0.000, 0.000, 100.000, , null, null, , 2025-12-07 08:55:03.436582+00, f, 66, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:563: in test_update_order_charge_status_full
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:03.435944+00, , , 3a68f538-ab08-48b9-8f31-091ca21f04df, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 136, null, null, 0.000, 0.000, 100.000, , null, null, , 2025-12-07 08:55:03.436582+00, f, 66, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderChargeStatus" name="test_update_order_charge_status_none" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:03.886047+00, , , d6422367-8f93-4509-a920-9d40037a213b, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 137, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:03.88675+00, f, 67, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:03.886047+00, , , d6422367-8f93-4509-a920-9d40037a213b, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 137, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:03.88675+00, f, 67, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:580: in test_update_order_charge_status_none
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:03.886047+00, , , d6422367-8f93-4509-a920-9d40037a213b, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 137, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:03.88675+00, f, 67, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderChargeStatus" name="test_update_order_charge_status_partial" time="0.009"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:04.360712+00, , , a376ab30-b96c-4849-80f6-5c494fcd362d, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 138, null, null, 0.000, 0.000, 50.000, , null, null, , 2025-12-07 08:55:04.36191+00, f, 68, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:04.360712+00, , , a376ab30-b96c-4849-80f6-5c494fcd362d, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 138, null, null, 0.000, 0.000, 50.000, , null, null, , 2025-12-07 08:55:04.36191+00, f, 68, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:597: in test_update_order_charge_status_partial
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:04.360712+00, , , a376ab30-b96c-4849-80f6-5c494fcd362d, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 138, null, null, 0.000, 0.000, 50.000, , null, null, , 2025-12-07 08:55:04.36191+00, f, 68, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderChargeStatus" name="test_update_order_charge_status_overcharged" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:04.821906+00, , , a1608a0d-1a53-4331-8325-f042d27d3ff4, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 139, null, null, 0.000, 0.000, 150.000, , null, null, , 2025-12-07 08:55:04.822782+00, f, 69, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:04.821906+00, , , a1608a0d-1a53-4331-8325-f042d27d3ff4, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 139, null, null, 0.000, 0.000, 150.000, , null, null, , 2025-12-07 08:55:04.822782+00, f, 69, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:614: in test_update_order_charge_status_overcharged
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:04.821906+00, , , a1608a0d-1a53-4331-8325-f042d27d3ff4, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 139, null, null, 0.000, 0.000, 150.000, , null, null, , 2025-12-07 08:55:04.822782+00, f, 69, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderChargeStatus" name="test_update_order_charge_status_with_granted_refund" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:05.518374+00, , , aea8a088-9d47-4391-8ae2-954d646ca50c, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 140, null, null, 0.000, 0.000, 80.000, , null, null, , 2025-12-07 08:55:05.519133+00, f, 70, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:05.518374+00, , , aea8a088-9d47-4391-8ae2-954d646ca50c, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 140, null, null, 0.000, 0.000, 80.000, , null, null, , 2025-12-07 08:55:05.519133+00, f, 70, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:631: in test_update_order_charge_status_with_granted_refund
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:05.518374+00, , , aea8a088-9d47-4391-8ae2-954d646ca50c, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 140, null, null, 0.000, 0.000, 80.000, , null, null, , 2025-12-07 08:55:05.519133+00, f, 70, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderAuthorizeStatus" name="test_update_order_authorize_status_full_zero_total" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:05.946897+00, , , 62ea52b6-abc4-43a5-a4c1-700270185f4b, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 141, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:05.947589+00, f, 71, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:05.946897+00, , , 62ea52b6-abc4-43a5-a4c1-700270185f4b, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 141, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:05.947589+00, f, 71, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:654: in test_update_order_authorize_status_full_zero_total
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:05.946897+00, , , 62ea52b6-abc4-43a5-a4c1-700270185f4b, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 141, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:05.947589+00, f, 71, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderAuthorizeStatus" name="test_update_order_authorize_status_none" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:06.373711+00, , , 68dab4b5-60ec-489a-8c8a-e3f6aa2f5116, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 142, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:06.374467+00, f, 72, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:06.373711+00, , , 68dab4b5-60ec-489a-8c8a-e3f6aa2f5116, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 142, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:06.374467+00, f, 72, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:672: in test_update_order_authorize_status_none
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:06.373711+00, , , 68dab4b5-60ec-489a-8c8a-e3f6aa2f5116, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 142, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:06.374467+00, f, 72, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderAuthorizeStatus" name="test_update_order_authorize_status_full_covered" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:06.79389+00, , , f931a79c-a528-4a62-82c3-996b38bc2a26, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 143, null, null, 0.000, 0.000, 40.000, , null, null, , 2025-12-07 08:55:06.794568+00, f, 73, null, 60.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:06.79389+00, , , f931a79c-a528-4a62-82c3-996b38bc2a26, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 143, null, null, 0.000, 0.000, 40.000, , null, null, , 2025-12-07 08:55:06.794568+00, f, 73, null, 60.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:690: in test_update_order_authorize_status_full_covered
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:06.79389+00, , , f931a79c-a528-4a62-82c3-996b38bc2a26, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 143, null, null, 0.000, 0.000, 40.000, , null, null, , 2025-12-07 08:55:06.794568+00, f, 73, null, 60.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestUpdateOrderAuthorizeStatus" name="test_update_order_authorize_status_partial" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:07.20993+00, , , 7253fa6d-6dfe-449b-aa91-3a05f5f53e34, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 144, null, null, 0.000, 0.000, 20.000, , null, null, , 2025-12-07 08:55:07.210685+00, f, 74, null, 30.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:07.20993+00, , , 7253fa6d-6dfe-449b-aa91-3a05f5f53e34, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 144, null, null, 0.000, 0.000, 20.000, , null, null, , 2025-12-07 08:55:07.210685+00, f, 74, null, 30.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_order_utils_comprehensive.py:709: in test_update_order_authorize_status_partial
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:07.20993+00, , , 7253fa6d-6dfe-449b-aa91-3a05f5f53e34, null, null, null, 0.000, null, en, 0.000, 100.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 144, null, null, 0.000, 0.000, 20.000, , null, null, , 2025-12-07 08:55:07.210685+00, f, 74, null, 30.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestCalculateDraftOrderLinePriceExpirationDate" name="test_calculate_draft_order_line_price_expiration_date_not_draft" time="0.005" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestCalculateDraftOrderLinePriceExpirationDate" name="test_calculate_draft_order_line_price_expiration_date_draft_no_freeze_period" time="0.006" /><testcase classname="tests.whitebox.test_order_utils_comprehensive.TestCalculateDraftOrderLinePriceExpirationDate" name="test_calculate_draft_order_line_price_expiration_date_draft_with_freeze_period" time="0.007" /><testcase classname="tests.whitebox.test_payment_utils.TestPaymentModel" name="test_payment_creation" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:07.673721+00, , , 308522db-d7de-4c5b-9e75-012b5a531e0d, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 148, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:07.674355+00, f, 75, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:07.673721+00, , , 308522db-d7de-4c5b-9e75-012b5a531e0d, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 148, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:07.674355+00, f, 75, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_payment_utils.py:33: in test_payment_creation
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:07.673721+00, , , 308522db-d7de-4c5b-9e75-012b5a531e0d, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 148, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:07.674355+00, f, 75, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_payment_utils.TestPaymentModel" name="test_payment_captured_amount" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:08.154532+00, , , 2e4cc151-4c25-4c50-bb21-2997eb9ba9c6, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 149, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:08.155271+00, f, 76, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:08.154532+00, , , 2e4cc151-4c25-4c50-bb21-2997eb9ba9c6, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 149, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:08.155271+00, f, 76, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_payment_utils.py:59: in test_payment_captured_amount
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:08.154532+00, , , 2e4cc151-4c25-4c50-bb21-2997eb9ba9c6, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 149, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:08.155271+00, f, 76, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_payment_utils.TestPaymentModel" name="test_payment_get_authorized" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:08.610368+00, , , 95b1dd2f-47a8-41db-8498-fcceb9138442, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 150, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:08.611146+00, f, 77, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:08.610368+00, , , 95b1dd2f-47a8-41db-8498-fcceb9138442, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 150, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:08.611146+00, f, 77, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_payment_utils.py:83: in test_payment_get_authorized
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:08.610368+00, , , 95b1dd2f-47a8-41db-8498-fcceb9138442, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 150, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:08.611146+00, f, 77, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_payment_utils.TestTransactionModel" name="test_transaction_creation" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:09.03628+00, , , c2402c20-e767-49d7-8227-ac9cdcca4784, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 151, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:09.036998+00, f, 78, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:09.03628+00, , , c2402c20-e767-49d7-8227-ac9cdcca4784, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 151, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:09.036998+00, f, 78, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_payment_utils.py:123: in test_transaction_creation
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:09.03628+00, , , c2402c20-e767-49d7-8227-ac9cdcca4784, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 151, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:09.036998+00, f, 78, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_payment_utils.TestTransactionModel" name="test_transaction_failed" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:09.443785+00, , , 0b08da93-a937-4817-97d0-09c8499f2445, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 152, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:09.444427+00, f, 79, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:09.443785+00, , , 0b08da93-a937-4817-97d0-09c8499f2445, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 152, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:09.444427+00, f, 79, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_payment_utils.py:155: in test_transaction_failed
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:09.443785+00, , , 0b08da93-a937-4817-97d0-09c8499f2445, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 152, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:09.444427+00, f, 79, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_payment_utils.TestTransactionItemModel" name="test_transaction_item_creation" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:09.866871+00, , , bf706213-235a-4a16-bf65-bc3470586be6, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 153, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:09.867567+00, f, 80, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:09.866871+00, , , bf706213-235a-4a16-bf65-bc3470586be6, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 153, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:09.867567+00, f, 80, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_payment_utils.py:195: in test_transaction_item_creation
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:09.866871+00, , , bf706213-235a-4a16-bf65-bc3470586be6, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 153, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:09.867567+00, f, 80, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_payment_utils.TestTransactionItemModel" name="test_transaction_item_authorized_amount" time="0.008"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:10.314845+00, , , fb97b260-cdf9-4b2b-a714-d40253da6b33, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 154, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:10.315621+00, f, 81, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:10.314845+00, , , fb97b260-cdf9-4b2b-a714-d40253da6b33, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 154, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:10.315621+00, f, 81, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_payment_utils.py:219: in test_transaction_item_authorized_amount
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:10.314845+00, , , fb97b260-cdf9-4b2b-a714-d40253da6b33, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 154, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:10.315621+00, f, 81, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_payment_utils.TestTransactionItemModel" name="test_transaction_item_charged_amount" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:10.757405+00, , , 66a5faf3-a1cb-49e6-bf75-a83d7eed57eb, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 155, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:10.758102+00, f, 82, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:10.757405+00, , , 66a5faf3-a1cb-49e6-bf75-a83d7eed57eb, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 155, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:10.758102+00, f, 82, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_payment_utils.py:242: in test_transaction_item_charged_amount
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:10.757405+00, , , 66a5faf3-a1cb-49e6-bf75-a83d7eed57eb, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 155, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:10.758102+00, f, 82, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreatePaymentLinesInformation" name="test_create_payment_lines_information_empty_lines" time="0.004"><failure message="TypeError: create_payment_lines_information() missing 1 required positional argument: 'manager'">tests/whitebox/test_payment_utils_additional.py:41: in test_create_payment_lines_information_empty_lines
    result = create_payment_lines_information(lines)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: create_payment_lines_information() missing 1 required positional argument: 'manager'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreatePaymentLinesInformation" name="test_create_payment_lines_information_with_lines" time="0.006"><failure message="TypeError: create_payment_lines_information() missing 1 required positional argument: 'manager'">tests/whitebox/test_payment_utils_additional.py:64: in test_create_payment_lines_information_with_lines
    result = create_payment_lines_information(lines)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: create_payment_lines_information() missing 1 required positional argument: 'manager'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreateCheckoutPaymentLinesInformation" name="test_create_checkout_payment_lines_information" time="0.008"><failure message="TypeError: create_checkout_payment_lines_information() missing 1 required positional argument: 'manager'">tests/whitebox/test_payment_utils_additional.py:86: in test_create_checkout_payment_lines_information
    result = create_checkout_payment_lines_information(checkout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: create_checkout_payment_lines_information() missing 1 required positional argument: 'manager'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreateOrderPaymentLinesInformation" name="test_create_order_payment_lines_information" time="0.013"><failure message="AssertionError: assert False&#10; +  where False = isinstance(PaymentLinesData(shipping_amount=Decimal('0.0'), voucher_amount=Decimal('0.0'), lines=[]), list)">tests/whitebox/test_payment_utils_additional.py:109: in test_create_order_payment_lines_information
    assert isinstance(result, list)
E   AssertionError: assert False
E    +  where False = isinstance(PaymentLinesData(shipping_amount=Decimal('0.0'), voucher_amount=Decimal('0.0'), lines=[]), list)</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestGenerateTransactionsData" name="test_generate_transactions_data_empty" time="0.010" /><testcase classname="tests.whitebox.test_payment_utils_additional.TestGenerateTransactionsData" name="test_generate_transactions_data_with_transactions" time="0.007"><failure message="TypeError: TransactionItem() got unexpected keyword arguments: 'payment', 'amount_value'">tests/whitebox/test_payment_utils_additional.py:148: in test_generate_transactions_data_with_transactions
    transaction = TransactionItem.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: TransactionItem() got unexpected keyword arguments: 'payment', 'amount_value'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreatePaymentInformation" name="test_create_payment_information_with_payment" time="0.008" /><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreatePaymentInformation" name="test_create_payment_information_with_checkout" time="0.008"><failure message="TypeError: create_payment_information() got an unexpected keyword argument 'customer_ip_address'">tests/whitebox/test_payment_utils_additional.py:204: in test_create_payment_information_with_checkout
    result = create_payment_information(
E   TypeError: create_payment_information() got an unexpected keyword argument 'customer_ip_address'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreatePaymentInformation" name="test_create_payment_information_with_order" time="0.010"><failure message="TypeError: create_payment_information() got an unexpected keyword argument 'customer_ip_address'">tests/whitebox/test_payment_utils_additional.py:232: in test_create_payment_information_with_order
    result = create_payment_information(
E   TypeError: create_payment_information() got an unexpected keyword argument 'customer_ip_address'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreatePayment" name="test_create_payment_basic" time="0.006"><failure message="TypeError: create_payment() got an unexpected keyword argument 'payment_method_info'">tests/whitebox/test_payment_utils_additional.py:264: in test_create_payment_basic
    result = create_payment(
E   TypeError: create_payment() got an unexpected keyword argument 'payment_method_info'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreatePayment" name="test_create_payment_with_checkout" time="0.007"><failure message="TypeError: create_payment() got an unexpected keyword argument 'payment_method_info'">tests/whitebox/test_payment_utils_additional.py:297: in test_create_payment_with_checkout
    result = create_payment(
E   TypeError: create_payment() got an unexpected keyword argument 'payment_method_info'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_additional.TestCreatePayment" name="test_create_payment_with_order" time="0.008"><failure message="TypeError: create_payment() got an unexpected keyword argument 'payment_method_info'">tests/whitebox/test_payment_utils_additional.py:329: in test_create_payment_with_order
    result = create_payment(
E   TypeError: create_payment() got an unexpected keyword argument 'payment_method_info'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_comprehensive.TestPaymentModels" name="test_payment_captured_amount" time="0.006"><failure message="TypeError: Payment() got unexpected keyword arguments: 'channel'">tests/whitebox/test_payment_utils_comprehensive.py:38: in test_payment_captured_amount
    payment = Payment.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Payment() got unexpected keyword arguments: 'channel'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_comprehensive.TestPaymentModels" name="test_payment_get_authorized" time="0.006"><failure message="TypeError: Payment() got unexpected keyword arguments: 'channel'">tests/whitebox/test_payment_utils_comprehensive.py:55: in test_payment_get_authorized
    payment = Payment.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: Payment() got unexpected keyword arguments: 'channel'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_comprehensive.TestTransactionItem" name="test_transaction_item_authorized_amount" time="0.006"><failure message="TypeError: TransactionItem() got unexpected keyword arguments: 'channel'">tests/whitebox/test_payment_utils_comprehensive.py:77: in test_transaction_item_authorized_amount
    transaction = TransactionItem.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: TransactionItem() got unexpected keyword arguments: 'channel'</failure></testcase><testcase classname="tests.whitebox.test_payment_utils_comprehensive.TestTransactionItem" name="test_transaction_item_charged_amount" time="0.006"><failure message="TypeError: TransactionItem() got unexpected keyword arguments: 'channel'">tests/whitebox/test_payment_utils_comprehensive.py:92: in test_transaction_item_charged_amount
    transaction = TransactionItem.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: TransactionItem() got unexpected keyword arguments: 'channel'</failure></testcase><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestGetTotalDiscount" name="test_get_total_discount_undiscounted_greater" time="0.004" /><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestGetTotalDiscount" name="test_get_total_discount_undiscounted_equal" time="0.004" /><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestGetTotalDiscount" name="test_get_total_discount_undiscounted_less" time="0.004" /><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestGetTotalDiscountFromRange" name="test_get_total_discount_from_range" time="0.005" /><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestGetProductPriceRange" name="test_get_product_price_range_price_field" time="0.025" /><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestGetProductPriceRange" name="test_get_product_price_range_discounted_price_field" time="0.021" /><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestGetProductPriceRange" name="test_get_product_price_range_prior_price_field" time="0.020" /><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestGetProductPriceRange" name="test_get_product_price_range_none_prices" time="0.016" /><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestCalculateProductPriceWithTaxes" name="test_calculate_product_price_with_taxes_flat_rates" time="0.007" /><testcase classname="tests.whitebox.test_product_availability_comprehensive.TestCalculateProductPriceWithTaxes" name="test_calculate_product_price_with_taxes_other_strategy" time="0.007" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetTotalDiscount" name="test_get_total_discount_undiscounted_greater" time="0.007" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetTotalDiscount" name="test_get_total_discount_undiscounted_equal" time="0.005" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetTotalDiscount" name="test_get_total_discount_undiscounted_less" time="0.004" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetTotalDiscountFromRange" name="test_get_total_discount_from_range_calculates_correctly" time="0.005" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetProductPriceRange" name="test_get_product_price_range_with_prices" time="0.014"><failure message="django.db.utils.IntegrityError: duplicate key value violates unique constraint &quot;product_producttype_slug_key&quot;&#10;DETAIL:  Key (slug)=() already exists.">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.UniqueViolation: duplicate key value violates unique constraint "product_producttype_slug_key"
E   DETAIL:  Key (slug)=() already exists.

The above exception was the direct cause of the following exception:
tests/whitebox/test_product_availability_utils_comprehensive.py:132: in test_get_product_price_range_with_prices
    product_type=ProductType.objects.create(name="Type"),
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: duplicate key value violates unique constraint "product_producttype_slug_key"
E   DETAIL:  Key (slug)=() already exists.</failure></testcase><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetProductPriceRange" name="test_get_product_price_range_with_none_prices" time="0.014" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetProductPriceRange" name="test_get_product_price_range_empty_list" time="0.004" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestCalculateProductPriceWithTaxes" name="test_calculate_product_price_with_taxes_flat_rates" time="0.006" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestCalculateProductPriceWithTaxes" name="test_calculate_product_price_with_taxes_other_strategy" time="0.005" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestCalculateProductPriceWithTaxesRange" name="test_calculate_product_price_with_taxes_range_with_prices" time="0.014" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestCalculateProductPriceWithTaxesRange" name="test_calculate_product_price_with_taxes_range_no_prices" time="0.014" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetProductAvailability" name="test_get_product_availability_with_discounts" time="0.015"><failure message="AssertionError: assert False is True&#10; +  where False = ProductAvailability(on_sale=False, price_range=TaxedMoneyRange(TaxedMoney(net=Money('7.984031936127744510978043912', 'USD'), gross=Money('8.00', 'USD')), TaxedMoney(net=Money('7.984031936127744510978043912', 'USD'), gross=Money('8.00', 'USD'))), price_range_undiscounted=TaxedMoneyRange(TaxedMoney(net=Money('9.980039920159680638722554890', 'USD'), gross=Money('10.00', 'USD')), TaxedMoney(net=Money('9.980039920159680638722554890', 'USD'), gross=Money('10.00', 'USD'))), price_range_prior=TaxedMoneyRange(TaxedMoney(net=Money('11.97604790419161676646706587', 'USD'), gross=Money('12.00', 'USD')), TaxedMoney(net=Money('11.97604790419161676646706587', 'USD'), gross=Money('12.00', 'USD'))), discount=TaxedMoney(net=Money('1.996007984031936127744510978', 'USD'), gross=Money('2.00', 'USD')), discount_prior=TaxedMoney(net=Money('3.992015968063872255489021958', 'USD'), gross=Money('4.00', 'USD'))).on_sale">tests/whitebox/test_product_availability_utils_comprehensive.py:335: in test_get_product_availability_with_discounts
    assert result.on_sale is True
E   AssertionError: assert False is True
E    +  where False = ProductAvailability(on_sale=False, price_range=TaxedMoneyRange(TaxedMoney(net=Money('7.984031936127744510978043912', 'USD'), gross=Money('8.00', 'USD')), TaxedMoney(net=Money('7.984031936127744510978043912', 'USD'), gross=Money('8.00', 'USD'))), price_range_undiscounted=TaxedMoneyRange(TaxedMoney(net=Money('9.980039920159680638722554890', 'USD'), gross=Money('10.00', 'USD')), TaxedMoney(net=Money('9.980039920159680638722554890', 'USD'), gross=Money('10.00', 'USD'))), price_range_prior=TaxedMoneyRange(TaxedMoney(net=Money('11.97604790419161676646706587', 'USD'), gross=Money('12.00', 'USD')), TaxedMoney(net=Money('11.97604790419161676646706587', 'USD'), gross=Money('12.00', 'USD'))), discount=TaxedMoney(net=Money('1.996007984031936127744510978', 'USD'), gross=Money('2.00', 'USD')), discount_prior=TaxedMoney(net=Money('3.992015968063872255489021958', 'USD'), gross=Money('4.00', 'USD'))).on_sale</failure></testcase><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetProductAvailability" name="test_get_product_availability_no_undiscounted" time="0.013" /><testcase classname="tests.whitebox.test_product_availability_utils_comprehensive.TestGetVariantAvailability" name="test_get_variant_availability_calculates_correctly" time="0.013"><failure message="TypeError: get_variant_availability() missing 1 required keyword-only argument: 'product_channel_listing'">tests/whitebox/test_product_availability_utils_comprehensive.py:404: in test_get_variant_availability_calculates_correctly
    result = get_variant_availability(
E   TypeError: get_variant_availability() missing 1 required keyword-only argument: 'product_channel_listing'</failure></testcase><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetBasePrice" name="test_get_base_price_price_override_none" time="0.013" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetBasePrice" name="test_get_base_price_price_override_provided" time="0.012" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetBasePriceDecision" name="test_decision_price_override_none_true" time="0.012" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetBasePriceDecision" name="test_decision_price_override_none_false" time="0.014" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPrice" name="test_get_price_price_override_none_with_discounted_price" time="0.013" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPrice" name="test_get_price_price_override_none_without_discounted_price" time="0.014" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPrice" name="test_get_price_price_override_provided" time="0.015" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPriceDecision" name="test_decision_price_override_none_true" time="0.014" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPriceDecision" name="test_decision_price_override_none_false" time="0.013" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPriceDecision" name="test_decision_discounted_price_exists_true" time="0.012" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPriceDecision" name="test_decision_discounted_price_exists_false" time="0.014" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPriorPriceAmount" name="test_get_prior_price_channel_listing_none" time="0.011" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPriorPriceAmount" name="test_get_prior_price_prior_price_none" time="0.013" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetPriorPriceAmount" name="test_get_prior_price_with_prior_price" time="0.013" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetWeight" name="test_get_weight_variant_weight_exists" time="0.011" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetWeight" name="test_get_weight_product_weight_exists" time="0.011" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantGetWeight" name="test_get_weight_product_type_weight_exists" time="0.011" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantIsDigital" name="test_is_digital_shipping_required_false_and_is_digital_true" time="0.012" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantIsDigital" name="test_is_digital_shipping_required_true" time="0.010" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantIsDigital" name="test_is_digital_is_digital_false" time="0.010" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantIsDigitalMCDC" name="test_mcdc_not_shipping_required_true_is_digital_true" time="0.011" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantIsDigitalMCDC" name="test_mcdc_not_shipping_required_false" time="0.011" /><testcase classname="tests.whitebox.test_product_models.TestProductVariantIsDigitalMCDC" name="test_mcdc_is_digital_false" time="0.010" /><testcase classname="tests.whitebox.test_product_utils.TestProductAvailability" name="test_get_product_availability_in_stock" time="0.014"><failure message="TypeError: get_product_availability() got an unexpected keyword argument 'product'">tests/whitebox/test_product_utils.py:48: in test_get_product_availability_in_stock
    availability = get_product_availability(
E   TypeError: get_product_availability() got an unexpected keyword argument 'product'</failure></testcase><testcase classname="tests.whitebox.test_product_utils.TestProductAvailability" name="test_get_product_availability_out_of_stock" time="0.012"><failure message="TypeError: get_product_availability() got an unexpected keyword argument 'product'">tests/whitebox/test_product_utils.py:79: in test_get_product_availability_out_of_stock
    availability = get_product_availability(
E   TypeError: get_product_availability() got an unexpected keyword argument 'product'</failure></testcase><testcase classname="tests.whitebox.test_product_utils.TestVariantSelectionAttributes" name="test_get_variant_selection_attributes" time="0.012"><failure message="TypeError: 'ProductVariant' object is not iterable">tests/whitebox/test_product_utils.py:112: in test_get_variant_selection_attributes
    attributes = get_variant_selection_attributes(variant)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/product/utils/variants.py:49: in get_variant_selection_attributes
    return [
E   TypeError: 'ProductVariant' object is not iterable</failure></testcase><testcase classname="tests.whitebox.test_shipping_utils.TestShippingModels" name="test_shipping_zone_creation" time="0.006" /><testcase classname="tests.whitebox.test_shipping_utils.TestShippingModels" name="test_shipping_method_creation" time="0.006" /><testcase classname="tests.whitebox.test_shipping_utils.TestShippingModels" name="test_shipping_method_channel_listing" time="0.009" /><testcase classname="tests.whitebox.test_shipping_utils.TestShippingModels" name="test_shipping_method_minimum_order_price" time="0.007"><failure message="TypeError: ShippingMethod() got unexpected keyword arguments: 'minimum_order_price_amount'">tests/whitebox/test_shipping_utils.py:95: in test_shipping_method_minimum_order_price
    method = ShippingMethod.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: ShippingMethod() got unexpected keyword arguments: 'minimum_order_price_amount'</failure></testcase><testcase classname="tests.whitebox.test_shipping_utils.TestShippingModels" name="test_shipping_method_maximum_order_price" time="0.006"><failure message="TypeError: ShippingMethod() got unexpected keyword arguments: 'maximum_order_price_amount'">tests/whitebox/test_shipping_utils.py:125: in test_shipping_method_maximum_order_price
    method = ShippingMethod.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:663: in create
    obj = self.model(**kwargs)
          ^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/base.py:569: in __init__
    raise TypeError(
E   TypeError: ShippingMethod() got unexpected keyword arguments: 'maximum_order_price_amount'</failure></testcase><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestGetAvailableQuantity" name="test_get_available_quantity_without_reservations" time="0.005"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (1625d9b8-acb1-4a74-80b4-e089a74b78ae, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (1625d9b8-acb1-4a74-80b4-e089a74b78ae, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_availability_comprehensive.py:35: in test_get_available_quantity_without_reservations
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (1625d9b8-acb1-4a74-80b4-e089a74b78ae, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestGetAvailableQuantity" name="test_get_available_quantity_with_reservations" time="0.005"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (73577959-abcf-4417-81f1-0ac21a117199, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (73577959-abcf-4417-81f1-0ac21a117199, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_availability_comprehensive.py:60: in test_get_available_quantity_with_reservations
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (73577959-abcf-4417-81f1-0ac21a117199, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestGetAvailableQuantity" name="test_get_available_quantity_returns_zero_if_negative" time="0.004"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (754e2e14-bdba-4674-9915-1099a9bcfb6c, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (754e2e14-bdba-4674-9915-1099a9bcfb6c, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_availability_comprehensive.py:86: in test_get_available_quantity_returns_zero_if_negative
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (754e2e14-bdba-4674-9915-1099a9bcfb6c, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestCheckStockAndPreorderQuantity" name="test_check_stock_and_preorder_quantity_preorder_active" time="0.013" /><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestCheckStockAndPreorderQuantity" name="test_check_stock_and_preorder_quantity_not_preorder" time="0.012" /><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestCheckStockQuantity" name="test_check_stock_quantity_sufficient_stock" time="0.005"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (3dd051d6-5a74-467a-be79-b825402bedfc, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (3dd051d6-5a74-467a-be79-b825402bedfc, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_availability_comprehensive.py:171: in test_check_stock_quantity_sufficient_stock
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (3dd051d6-5a74-467a-be79-b825402bedfc, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestCheckStockQuantity" name="test_check_stock_quantity_insufficient_stock" time="0.006"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (266f04ad-c64b-4015-8cd4-870e9dc01660, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (266f04ad-c64b-4015-8cd4-870e9dc01660, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_availability_comprehensive.py:201: in test_check_stock_quantity_insufficient_stock
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (266f04ad-c64b-4015-8cd4-870e9dc01660, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestGetAvailableQuantityFunction" name="test_get_available_quantity_returns_correct_value" time="0.006"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (c901372a-098a-438c-a5de-2fbf254c3f98, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (c901372a-098a-438c-a5de-2fbf254c3f98, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_availability_comprehensive.py:236: in test_get_available_quantity_returns_correct_value
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (c901372a-098a-438c-a5de-2fbf254c3f98, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestIsProductInStock" name="test_is_product_in_stock_has_stock" time="0.006"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (31fe560a-bef4-4274-805a-10e9f7909127, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (31fe560a-bef4-4274-805a-10e9f7909127, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_availability_comprehensive.py:268: in test_is_product_in_stock_has_stock
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (31fe560a-bef4-4274-805a-10e9f7909127, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_availability_comprehensive.TestIsProductInStock" name="test_is_product_in_stock_no_stock" time="0.025" /><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestGetOrderLinesWithTrackInventory" name="test_get_order_lines_with_track_inventory_tracks_inventory" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:16.94711+00, , , 8f567a01-1bd9-4f15-837e-d0ee94fbd13f, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 207, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:16.947765+00, f, 86, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:16.94711+00, , , 8f567a01-1bd9-4f15-837e-d0ee94fbd13f, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 207, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:16.947765+00, f, 86, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:47: in test_get_order_lines_with_track_inventory_tracks_inventory
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:16.94711+00, , , 8f567a01-1bd9-4f15-837e-d0ee94fbd13f, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 207, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:16.947765+00, f, 86, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestGetOrderLinesWithTrackInventory" name="test_get_order_lines_with_track_inventory_no_track" time="0.007"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:17.40893+00, , , 867cdd8f-b5ca-4925-9ae0-2f4e0f78ea9c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 208, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:17.409633+00, f, 87, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:17.40893+00, , , 867cdd8f-b5ca-4925-9ae0-2f4e0f78ea9c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 208, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:17.409633+00, f, 87, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:83: in test_get_order_lines_with_track_inventory_no_track
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:17.40893+00, , , 867cdd8f-b5ca-4925-9ae0-2f4e0f78ea9c, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 208, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:17.409633+00, f, 87, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestGetOrderLinesWithTrackInventory" name="test_get_order_lines_with_track_inventory_no_variant" time="0.010"><failure message="django.db.utils.IntegrityError: null value in column &quot;lines_count&quot; of relation &quot;order_order&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2025-12-07 08:55:17.884086+00, , , 3d1147d1-805b-44e9-8fe1-c2c583c853b8, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 209, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:17.885039+00, f, 88, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:17.884086+00, , , 3d1147d1-805b-44e9-8fe1-c2c583c853b8, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 209, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:17.885039+00, f, 88, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:118: in test_get_order_lines_with_track_inventory_no_variant
    order = Order.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "lines_count" of relation "order_order" violates not-null constraint
E   DETAIL:  Failing row contains (2025-12-07 08:55:17.884086+00, , , 3d1147d1-805b-44e9-8fe1-c2c583c853b8, null, null, null, 0.000, null, en, 0.000, 0.000, 0.000, unfulfilled, null, null, t, , 0, , USD, {}, {}, 209, null, null, 0.000, 0.000, 0.000, , null, null, , 2025-12-07 08:55:17.885039+00, f, 88, null, 0.000, none, none, null, t, f, 0.000, null, {}, null, {}, null, null, null, 0.000, 0.000, null, 0.000, null, null, null, {}, {}).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestIncreaseStock" name="test_increase_stock_creates_stock_if_not_exists" time="0.005"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (0bdc298c-8d17-49bd-bfd2-a364a3b22ebf, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (0bdc298c-8d17-49bd-bfd2-a364a3b22ebf, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:145: in test_increase_stock_creates_stock_if_not_exists
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (0bdc298c-8d17-49bd-bfd2-a364a3b22ebf, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestIncreaseStock" name="test_increase_stock_increases_existing_stock" time="0.005"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (8b5936ec-e2e2-4880-b316-1886d4473917, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (8b5936ec-e2e2-4880-b316-1886d4473917, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:164: in test_increase_stock_increases_existing_stock
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (8b5936ec-e2e2-4880-b316-1886d4473917, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestIncreaseStock" name="test_increase_stock_with_allocate" time="0.005"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (2f65ed40-ff90-4ec8-9071-45dc2c896b2d, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (2f65ed40-ff90-4ec8-9071-45dc2c896b2d, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:193: in test_increase_stock_with_allocate
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (2f65ed40-ff90-4ec8-9071-45dc2c896b2d, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestDecreaseStock" name="test_decrease_stock_decreases_quantity" time="0.004"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (7fb4deaa-8590-4247-a70f-165ddcbd036d, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (7fb4deaa-8590-4247-a70f-165ddcbd036d, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:230: in test_decrease_stock_decreases_quantity
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (7fb4deaa-8590-4247-a70f-165ddcbd036d, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestIncreaseAllocations" name="test_increase_allocations_creates_allocation" time="0.006"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (628537ae-647e-4a39-b4f3-bbaa00a7b03f, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (628537ae-647e-4a39-b4f3-bbaa00a7b03f, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:264: in test_increase_allocations_creates_allocation
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (628537ae-647e-4a39-b4f3-bbaa00a7b03f, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestIncreaseAllocations" name="test_increase_allocations_increases_existing_allocation" time="0.006"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (cd66c314-7f0e-4acd-9299-98be208aa8ce, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (cd66c314-7f0e-4acd-9299-98be208aa8ce, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:312: in test_increase_allocations_increases_existing_allocation
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (cd66c314-7f0e-4acd-9299-98be208aa8ce, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestDecreaseAllocations" name="test_decrease_allocations_decreases_quantity" time="0.006"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (441b5de7-0cd8-4aa0-b227-32510b56be0f, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (441b5de7-0cd8-4aa0-b227-32510b56be0f, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:369: in test_decrease_allocations_decreases_quantity
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (441b5de7-0cd8-4aa0-b227-32510b56be0f, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestDecreaseAllocations" name="test_decrease_allocations_deletes_allocation_when_zero" time="0.006"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (895ab8ad-1906-49ff-9aee-bd061f851982, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (895ab8ad-1906-49ff-9aee-bd061f851982, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:421: in test_decrease_allocations_deletes_allocation_when_zero
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (895ab8ad-1906-49ff-9aee-bd061f851982, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_warehouse_management_comprehensive.TestDeallocateStock" name="test_deallocate_stock_deallocates_for_lines" time="0.006"><failure message="django.db.utils.IntegrityError: null value in column &quot;address_id&quot; of relation &quot;warehouse_warehouse&quot; violates not-null constraint&#10;DETAIL:  Failing row contains (ae0e30ba-492e-4120-b828-54cacd5d5733, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).">.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.NotNullViolation: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (ae0e30ba-492e-4120-b828-54cacd5d5733, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).

The above exception was the direct cause of the following exception:
tests/whitebox/test_warehouse_management_comprehensive.py:478: in test_deallocate_stock_deallocates_for_lines
    warehouse = Warehouse.objects.create(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:665: in create
    obj.save(force_insert=True, using=self.db)
.venv/lib/python3.12/site-packages/django/db/models/base.py:902: in save
    self.save_base(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1008: in save_base
    updated = self._save_table(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1169: in _save_table
    results = self._do_insert(
.venv/lib/python3.12/site-packages/django/db/models/base.py:1210: in _do_insert
    return manager._insert(
.venv/lib/python3.12/site-packages/django/db/models/manager.py:87: in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:1873: in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1882: in execute_sql
    cursor.execute(sql, params)
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:79: in execute
    return self._execute_with_wrappers(
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:92: in _execute_with_wrappers
    return executor(sql, params, many, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:100: in _execute
    with self.db.wrap_database_errors:
.venv/lib/python3.12/site-packages/django/db/utils.py:91: in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
.venv/lib/python3.12/site-packages/django/db/backends/utils.py:105: in _execute
    return self.cursor.execute(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/psycopg/cursor.py:117: in execute
    raise ex.with_traceback(None)
E   django.db.utils.IntegrityError: null value in column "address_id" of relation "warehouse_warehouse" violates not-null constraint
E   DETAIL:  Failing row contains (ae0e30ba-492e-4120-b828-54cacd5d5733, Test Warehouse, , null, test-warehouse, {}, {}, disabled, t, null).</failure></testcase><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_event_type_async" time="0.005" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_event_type_sync" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_apps_ids" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_apps_identifier" time="0.005" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_app_deleted_event" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEvent" name="test_get_filter_without_permissions" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetWebhooksForEvent" name="test_get_webhooks_without_webhooks_param" time="0.007" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetWebhooksForEvent" name="test_get_webhooks_with_webhooks_param" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetWebhooksForEvent" name="test_get_webhooks_with_apps_ids" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetWebhooksForEvent" name="test_get_webhooks_with_apps_identifier" time="0.007" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetWebhooksForMultipleEvents" name="test_get_webhooks_for_single_event" time="0.005"><failure message="django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.">tests/whitebox/test_webhook_utils.py:107: in test_get_webhooks_for_single_event
    result = get_webhooks_for_multiple_events(event_types)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/webhook/utils.py:97: in get_webhooks_for_multiple_events
    for webhook_id, event_type in webhook_id_to_event_type:
.venv/lib/python3.12/site-packages/django/db/models/query.py:386: in __iter__
    self._fetch_all()
.venv/lib/python3.12/site-packages/django/db/models/query.py:1954: in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:234: in __iter__
    return compiler.results_iter(
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1572: in results_iter
    results = self.execute_sql(
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1621: in execute_sql
    cursor = self.connection.cursor()
             ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/test/testcases.py:201: in __call__
    raise DatabaseOperationForbidden(self.message)
E   django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.</failure></testcase><testcase classname="tests.whitebox.test_webhook_utils.TestGetWebhooksForMultipleEvents" name="test_get_webhooks_for_multiple_events" time="0.005"><failure message="django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.">tests/whitebox/test_webhook_utils.py:116: in test_get_webhooks_for_multiple_events
    result = get_webhooks_for_multiple_events(event_types)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/webhook/utils.py:97: in get_webhooks_for_multiple_events
    for webhook_id, event_type in webhook_id_to_event_type:
.venv/lib/python3.12/site-packages/django/db/models/query.py:386: in __iter__
    self._fetch_all()
.venv/lib/python3.12/site-packages/django/db/models/query.py:1954: in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:234: in __iter__
    return compiler.results_iter(
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1572: in results_iter
    results = self.execute_sql(
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1621: in execute_sql
    cursor = self.connection.cursor()
             ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/test/testcases.py:201: in __call__
    raise DatabaseOperationForbidden(self.message)
E   django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.</failure></testcase><testcase classname="tests.whitebox.test_webhook_utils.TestGetWebhooksForMultipleEvents" name="test_get_webhooks_with_async_event_adds_any" time="0.005"><failure message="django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.">tests/whitebox/test_webhook_utils.py:122: in test_get_webhooks_with_async_event_adds_any
    result = get_webhooks_for_multiple_events(event_types)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
saleor/webhook/utils.py:97: in get_webhooks_for_multiple_events
    for webhook_id, event_type in webhook_id_to_event_type:
.venv/lib/python3.12/site-packages/django/db/models/query.py:386: in __iter__
    self._fetch_all()
.venv/lib/python3.12/site-packages/django/db/models/query.py:1954: in _fetch_all
    self._result_cache = list(self._iterable_class(self))
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/db/models/query.py:234: in __iter__
    return compiler.results_iter(
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1572: in results_iter
    results = self.execute_sql(
.venv/lib/python3.12/site-packages/django/db/models/sql/compiler.py:1621: in execute_sql
    cursor = self.connection.cursor()
             ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/django/test/testcases.py:201: in __call__
    raise DatabaseOperationForbidden(self.message)
E   django.test.testcases.DatabaseOperationForbidden: Database queries to 'replica' are not allowed in this test. Add 'replica' to pytest_django.fixtures._django_db_helper.&lt;locals&gt;.PytestDjangoTestCase.databases to ensure proper test isolation and silence this failure.</failure></testcase><testcase classname="tests.whitebox.test_webhook_utils.TestGetWebhooksForMultipleEvents" name="test_get_webhooks_with_empty_list" time="0.007" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEventDecisionCoverage" name="test_decision_with_permissions" time="0.005" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEventDecisionCoverage" name="test_decision_without_permissions" time="0.005" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEventDecisionCoverage" name="test_decision_app_deleted_vs_other" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEventDecisionCoverage" name="test_decision_with_apps_ids" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils.TestGetFilterForSingleWebhookEventDecisionCoverage" name="test_decision_with_apps_identifier" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_event_type_async" time="0.005" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_event_type_sync" time="0.005" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_apps_ids" time="0.005" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_apps_identifier" time="0.005" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_both_apps_ids_and_identifier" time="0.005" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetFilterForSingleWebhookEvent" name="test_get_filter_with_app_deleted_event" time="0.004" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetFilterForSingleWebhookEvent" name="test_get_filter_without_permissions" time="0.004" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetWebhooksForEvent" name="test_get_webhooks_for_event_with_webhooks_queryset" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetWebhooksForEvent" name="test_get_webhooks_for_event_without_webhooks" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetWebhooksForEvent" name="test_get_webhooks_for_event_with_apps_ids" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetWebhooksForEvent" name="test_get_webhooks_for_event_with_apps_identifier" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetWebhooksForMultipleEvents" name="test_get_webhooks_for_multiple_events_empty" time="0.006" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetWebhooksForMultipleEvents" name="test_get_webhooks_for_multiple_events_single" time="0.008" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetWebhooksForMultipleEvents" name="test_get_webhooks_for_multiple_events_multiple" time="0.008" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetWebhooksForMultipleEvents" name="test_get_webhooks_for_multiple_events_with_any" time="0.008" /><testcase classname="tests.whitebox.test_webhook_utils_comprehensive.TestGetWebhooksForMultipleEvents" name="test_get_webhooks_for_multiple_events_with_sync_events" time="0.007" /><testcase classname="tests.integration.test_api" name="test_graphql_products_query" time="0.017" /><testcase classname="tests.integration.test_api" name="test_static_files" time="0.003" /><testcase classname="tests.test_basic" name="test_health" time="0.003" /><testcase classname="tests.test_basic" name="test_graphql" time="0.156" /></testsuite></testsuites>